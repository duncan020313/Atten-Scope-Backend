
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Matrix Heatmap</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        .viewer {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }
        #buttons {
            margin-bottom: 10px;
        }
        .button {
            display: inline-block;
            margin-right: 5px;
            cursor: pointer;
            text-align: center;
        }
        .button {
            border: 1px solid black;
        }
        .button.neon {
            box-shadow: 0 0 10px #00f, 0 0 20px #00f, 0 0 30px #00f, 0 0 40px #00f;
        }
        .token {
            display: inline-block;
            cursor: pointer;
            margin: 2px 0;
            padding: 2px 5px;
        }
        .token:hover {
            text-decoration: underline;
        }
        #tokens {
            margin-left: 20px;
            word-wrap: break-word;
            font-size: 30px;
        }
        .canvas-wrapper {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: min(75vw, 75vh);
            height: min(75vw, 75vh);
        }
        canvas {
            width: 100%;
            height: 100%;
        }
        .token-viewer {
            display: flex;
            flex-direction: column;
            justify-content: top;
            align-items: center;
            height: 75vh;
            overflow-y: auto;
        }
        .mode-buttons {
            margin-bottom: 10px;
        }
        .mode-button {
            cursor: pointer;
            padding: 5px 10px;
            margin-right: 5px;
            border: 1px solid black;
            border-radius: 3px;
        }
        .mode-button.active {
            background-color: #00f;
            color: #fff;
        }
        .legend {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
        }

        .legend canvas {
            border: 1px solid black;
        }

    </style>
</head>
<body>
<div id="buttons">
    <div class="button" id="button0" onmouseover="showMatrix(0, true)" onclick="toggleFixMatrix(0)"><canvas id="previewCanvas0" width="50" height="50"></canvas><br>Head 0</div><div class="button" id="button1" onmouseover="showMatrix(1, true)" onclick="toggleFixMatrix(1)"><canvas id="previewCanvas1" width="50" height="50"></canvas><br>Head 1</div><div class="button" id="button2" onmouseover="showMatrix(2, true)" onclick="toggleFixMatrix(2)"><canvas id="previewCanvas2" width="50" height="50"></canvas><br>Head 2</div><div class="button" id="button3" onmouseover="showMatrix(3, true)" onclick="toggleFixMatrix(3)"><canvas id="previewCanvas3" width="50" height="50"></canvas><br>Head 3</div><div class="button" id="button4" onmouseover="showMatrix(4, true)" onclick="toggleFixMatrix(4)"><canvas id="previewCanvas4" width="50" height="50"></canvas><br>Head 4</div><div class="button" id="button5" onmouseover="showMatrix(5, true)" onclick="toggleFixMatrix(5)"><canvas id="previewCanvas5" width="50" height="50"></canvas><br>Head 5</div><div class="button" id="button6" onmouseover="showMatrix(6, true)" onclick="toggleFixMatrix(6)"><canvas id="previewCanvas6" width="50" height="50"></canvas><br>Head 6</div><div class="button" id="button7" onmouseover="showMatrix(7, true)" onclick="toggleFixMatrix(7)"><canvas id="previewCanvas7" width="50" height="50"></canvas><br>Head 7</div><div class="button" id="button8" onmouseover="showMatrix(8, true)" onclick="toggleFixMatrix(8)"><canvas id="previewCanvas8" width="50" height="50"></canvas><br>Head 8</div><div class="button" id="button9" onmouseover="showMatrix(9, true)" onclick="toggleFixMatrix(9)"><canvas id="previewCanvas9" width="50" height="50"></canvas><br>Head 9</div><div class="button" id="button10" onmouseover="showMatrix(10, true)" onclick="toggleFixMatrix(10)"><canvas id="previewCanvas10" width="50" height="50"></canvas><br>Head 10</div><div class="button" id="button11" onmouseover="showMatrix(11, true)" onclick="toggleFixMatrix(11)"><canvas id="previewCanvas11" width="50" height="50"></canvas><br>Head 11</div><div class="button" id="button12" onmouseover="showMatrix(12, true)" onclick="toggleFixMatrix(12)"><canvas id="previewCanvas12" width="50" height="50"></canvas><br>Head 12</div><div class="button" id="button13" onmouseover="showMatrix(13, true)" onclick="toggleFixMatrix(13)"><canvas id="previewCanvas13" width="50" height="50"></canvas><br>Head 13</div><div class="button" id="button14" onmouseover="showMatrix(14, true)" onclick="toggleFixMatrix(14)"><canvas id="previewCanvas14" width="50" height="50"></canvas><br>Head 14</div><div class="button" id="button15" onmouseover="showMatrix(15, true)" onclick="toggleFixMatrix(15)"><canvas id="previewCanvas15" width="50" height="50"></canvas><br>Head 15</div><div class="button" id="button16" onmouseover="showMatrix(16, true)" onclick="toggleFixMatrix(16)"><canvas id="previewCanvas16" width="50" height="50"></canvas><br>Head 16</div><div class="button" id="button17" onmouseover="showMatrix(17, true)" onclick="toggleFixMatrix(17)"><canvas id="previewCanvas17" width="50" height="50"></canvas><br>Head 17</div><div class="button" id="button18" onmouseover="showMatrix(18, true)" onclick="toggleFixMatrix(18)"><canvas id="previewCanvas18" width="50" height="50"></canvas><br>Head 18</div><div class="button" id="button19" onmouseover="showMatrix(19, true)" onclick="toggleFixMatrix(19)"><canvas id="previewCanvas19" width="50" height="50"></canvas><br>Head 19</div>
</div>
<div class="viewer">
    <div class="canvas-wrapper">
        <canvas id="heatmapCanvas"></canvas>
        <div class="legend">
            <canvas id="legendCanvas" width="200" height="20"></canvas>
        </div>
    </div>
    <div class="token-viewer">
        <div class="mode-buttons">
            <div class="mode-button active" id="rowMode" onclick="setMode('row')">Row Mode</div>
            <div class="mode-button" id="columnMode" onclick="setMode('column')">Column Mode</div>
        </div>
        <div id="tokens">
            <span class="token" id="token0" onmouseover="highlightRowOrColumnAndToken(0)" onclick="toggleFixRowOrColumn(0)">&lt;|endoftext|&gt;</span><span class="token" id="token1" onmouseover="highlightRowOrColumnAndToken(1)" onclick="toggleFixRowOrColumn(1)">def</span><span class="token" id="token2" onmouseover="highlightRowOrColumnAndToken(2)" onclick="toggleFixRowOrColumn(2)">&nbsp;main</span><span class="token" id="token3" onmouseover="highlightRowOrColumnAndToken(3)" onclick="toggleFixRowOrColumn(3)">():</span><span class="token" id="token4" onmouseover="highlightRowOrColumnAndToken(4)" onclick="toggleFixRowOrColumn(4)">www</span>
        </div>
    </div>
</div>
<script>
    const canvas = document.getElementById('heatmapCanvas');
    const ctx = canvas.getContext('2d');
    const matrices = [[[1.0, 0.0, 0.0, 0.0, 0.0], [0.7776299715042114, 0.222369983792305, 0.0, 0.0, 0.0], [0.1967068612575531, 0.21590493619441986, 0.5873881578445435, 0.0, 0.0], [0.04204495623707771, 0.16001074016094208, 0.6907121539115906, 0.10723211616277695, 0.0], [0.18954700231552124, 0.05786920711398125, 0.28711989521980286, 0.38376131653785706, 0.08170253783464432]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8496338129043579, 0.1503661423921585, 0.0, 0.0, 0.0], [0.33708417415618896, 0.08004043251276016, 0.5828753709793091, 0.0, 0.0], [0.37574777007102966, 0.12309297919273376, 0.02121145837008953, 0.4799478054046631, 0.0], [0.42236554622650146, 0.04671555384993553, 0.1836148500442505, 0.03223000839352608, 0.31507402658462524]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.29033613204956055, 0.7096639275550842, 0.0, 0.0, 0.0], [0.45453816652297974, 0.48020264506340027, 0.06525919586420059, 0.0, 0.0], [0.29223015904426575, 0.3547726273536682, 0.06990859657526016, 0.2830885350704193, 0.0], [0.6214621067047119, 0.24591922760009766, 0.04661968722939491, 0.06878667324781418, 0.017212344333529472]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.11161855608224869, 0.8883814215660095, 0.0, 0.0, 0.0], [0.22115014493465424, 0.14695687592029572, 0.6318929195404053, 0.0, 0.0], [0.32416680455207825, 0.14289221167564392, 0.39598706364631653, 0.1369539499282837, 0.0], [0.14211906492710114, 0.05615396425127983, 0.22318458557128906, 0.06880006939172745, 0.5097423195838928]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.05859670415520668, 0.9414032697677612, 0.0, 0.0, 0.0], [0.05562208965420723, 0.850872278213501, 0.09350564330816269, 0.0, 0.0], [0.03546581417322159, 0.22187352180480957, 0.029954997822642326, 0.7127056121826172, 0.0], [0.045414455235004425, 0.116001196205616, 0.0061527518555521965, 0.7941538691520691, 0.03827774524688721]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8731282949447632, 0.12687169015407562, 0.0, 0.0, 0.0], [0.5576737523078918, 0.38150259852409363, 0.06082356348633766, 0.0, 0.0], [0.3966529667377472, 0.24689632654190063, 0.1508999615907669, 0.20555074512958527, 0.0], [0.2687492072582245, 0.09573719650506973, 0.07720448821783066, 0.4998524487018585, 0.05845671519637108]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.45546334981918335, 0.5445366501808167, 0.0, 0.0, 0.0], [0.040104273706674576, 0.8134903311729431, 0.1464053988456726, 0.0, 0.0], [0.02287258952856064, 0.20849554240703583, 0.33767053484916687, 0.4309613108634949, 0.0], [0.02357146143913269, 0.038176279515028, 0.021894559264183044, 0.6685454249382019, 0.24781228601932526]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9287818670272827, 0.07121814042329788, 0.0, 0.0, 0.0], [0.38532695174217224, 0.5120904445648193, 0.1025826632976532, 0.0, 0.0], [0.018154751509428024, 0.0875537320971489, 0.8610253930091858, 0.0332660973072052, 0.0], [0.05199522152543068, 0.07241390645503998, 0.2662216126918793, 0.47988444566726685, 0.12948481738567352]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.5133691430091858, 0.486630916595459, 0.0, 0.0, 0.0], [0.12510156631469727, 0.5206072926521301, 0.3542911410331726, 0.0, 0.0], [0.0342273972928524, 0.4242818057537079, 0.1896274983882904, 0.3518632650375366, 0.0], [0.025320202112197876, 0.19706596434116364, 0.11214358359575272, 0.4669894576072693, 0.1984807848930359]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8375656008720398, 0.1624343991279602, 0.0, 0.0, 0.0], [0.17232747375965118, 0.6266738772392273, 0.20099861919879913, 0.0, 0.0], [0.07012267410755157, 0.5044371485710144, 0.31977224349975586, 0.10566781461238861, 0.0], [0.14959654211997986, 0.3847419023513794, 0.1615487039089203, 0.22174738347530365, 0.08236552774906158]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.7565577030181885, 0.2434423714876175, 0.0, 0.0, 0.0], [0.23488551378250122, 0.32612496614456177, 0.4389895498752594, 0.0, 0.0], [0.201081782579422, 0.21851588785648346, 0.14008314907550812, 0.44031915068626404, 0.0], [0.18651701509952545, 0.16615886986255646, 0.17221149802207947, 0.3776378631591797, 0.09747474640607834]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.613551139831543, 0.3864488899707794, 0.0, 0.0, 0.0], [0.12059883028268814, 0.8041321039199829, 0.07526906579732895, 0.0, 0.0], [0.019450953230261803, 0.8096597790718079, 0.06035064160823822, 0.11053867638111115, 0.0], [0.015339169651269913, 0.8374489545822144, 0.03640181943774223, 0.10810332000255585, 0.0027068539056926966]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.059939976781606674, 0.9400600790977478, 0.0, 0.0, 0.0], [0.300788938999176, 0.09501758962869644, 0.6041934490203857, 0.0, 0.0], [0.13631056249141693, 0.23815502226352692, 0.08862832933664322, 0.5369061231613159, 0.0], [0.040865108370780945, 0.1612175852060318, 0.5403755903244019, 0.02326667122542858, 0.2342749387025833]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9478954076766968, 0.05210457742214203, 0.0, 0.0, 0.0], [0.021054746583104134, 0.9772716164588928, 0.0016736637335270643, 0.0, 0.0], [0.2344447821378708, 0.0041116708889603615, 0.7582792639732361, 0.0031642233952879906, 0.0], [0.00014879321679472923, 0.00010812779510160908, 1.0844712960533798e-05, 0.99811851978302, 0.0016137517523020506]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.7348812222480774, 0.2651187777519226, 0.0, 0.0, 0.0], [0.17620451748371124, 0.07416120916604996, 0.7496342658996582, 0.0, 0.0], [0.06903821229934692, 0.1132224053144455, 0.41502782702445984, 0.40271151065826416, 0.0], [0.18478776514530182, 0.0635170042514801, 0.08392102271318436, 0.27047500014305115, 0.39729925990104675]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.18821491301059723, 0.811785101890564, 0.0, 0.0, 0.0], [0.17326121032238007, 0.293297678232193, 0.5334411263465881, 0.0, 0.0], [0.216936394572258, 0.15043748915195465, 0.19167771935462952, 0.4409484267234802, 0.0], [0.3250168561935425, 0.1794116199016571, 0.030485067516565323, 0.42633193731307983, 0.03875452280044556]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.6571974158287048, 0.34280258417129517, 0.0, 0.0, 0.0], [0.40579521656036377, 0.12305774539709091, 0.4711470603942871, 0.0, 0.0], [0.19845682382583618, 0.13885986804962158, 0.23471134901046753, 0.4279719293117523, 0.0], [0.26607704162597656, 0.006364982109516859, 0.1367216408252716, 0.37471210956573486, 0.2161242514848709]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.873867392539978, 0.12613265216350555, 0.0, 0.0, 0.0], [0.4580828547477722, 0.06002427637577057, 0.4818929135799408, 0.0, 0.0], [0.26557138562202454, 0.22870975732803345, 0.3499593436717987, 0.1557595431804657, 0.0], [0.5411921739578247, 0.04373716562986374, 0.25867947936058044, 0.022258497774600983, 0.13413266837596893]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.277719646692276, 0.7222803831100464, 0.0, 0.0, 0.0], [0.18797731399536133, 0.39348477125167847, 0.4185379147529602, 0.0, 0.0], [0.1463499367237091, 0.09489462524652481, 0.5855420827865601, 0.17321333289146423, 0.0], [0.25583627820014954, 0.2883438467979431, 0.13405758142471313, 0.2755779027938843, 0.04618441313505173]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.11767186224460602, 0.8823281526565552, 0.0, 0.0, 0.0], [0.13788782060146332, 0.4126233756542206, 0.4494887888431549, 0.0, 0.0], [0.18360498547554016, 0.5266645550727844, 0.2381420135498047, 0.05158844590187073, 0.0], [0.33078864216804504, 0.3494154214859009, 0.04727925360202789, 0.19073715806007385, 0.08177953958511353]]];
    const rows = 5;
    const cols = 5;
    const minVals = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0];
    const maxVals = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];
    const hues = [284, 224, 144, 180, 290, 252, 104, 75, 179, 311, 246, 226, 160, 306, 122, 25, 326, 213, 218, 303];
    let fixedMatrixIndex = null;
    let currentMatrixIndex = 0;
    let currentMode = 'row'; // Default mode
    const legendCanvas = document.getElementById('legendCanvas');
    const legendCtx = legendCanvas.getContext('2d');

    function resizeCanvas() {
        const canvasWrapper = document.querySelector('.canvas-wrapper');
        canvas.width = canvasWrapper.clientWidth;
        canvas.height = canvasWrapper.clientHeight;
        drawMatrix(currentMatrixIndex);
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function valueToColor(value, minVal, maxVal, hue, dim = false) {
        const normalizedValue = (value - minVal) / (maxVal - minVal);
        const lightness = 100 - Math.floor(normalizedValue * 75);  // lightness from 25% to 100%
        if (dim) {
            return `hsl(${hue}, 0%, ${lightness}%)`;  // Dim the brightness for non-highlighted rows
        }
        return `hsl(${hue}, 100%, ${lightness}%)`;
    }

    function drawMatrix(matrixIndex, highlightIndex = null) {
        const data = matrices[matrixIndex];
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        const currentRows = data.length;
        const currentCols = data[0].length;
        const cellWidth = Math.floor(canvas.width / currentCols);
        const cellHeight = Math.floor(canvas.height / currentRows);

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        for (let i = 0; i < currentRows; i++) {
            for (let j = 0; j < currentCols; j++) {
                let dim = false;
                if (highlightIndex !== null) {
                    if (currentMode === 'row' && i !== highlightIndex) {
                        dim = true;
                    } else if (currentMode === 'column' && j !== highlightIndex) {
                        dim = true;
                    }
                }
                ctx.fillStyle = valueToColor(data[i][j], minVal, maxVal, hue, dim);
                ctx.fillRect(j * cellWidth, i * cellHeight, cellWidth, cellHeight);
            }
        }
    }

    function showMatrix(matrixIndex, updateTokens = false) {
        currentMatrixIndex = matrixIndex;
        if (fixedMatrixIndex === null) {
            drawMatrix(matrixIndex);
        }
        if (updateTokens) {
            const rowOrColumn = matrices[matrixIndex][0];
            const minVal = minVals[matrixIndex];
            const maxVal = maxVals[matrixIndex];
            const hue = hues[matrixIndex];
            for (let i = 0; i < rowOrColumn.length; i++) {
                const tokenElem = document.getElementById('token' + i);
                tokenElem.style.backgroundColor = valueToColor(rowOrColumn[i], minVal, maxVal, hue);
            }
        }
        updateLegend();
    }
    
    function drawLegend(minVal, maxVal, hue) {
        const gradient = legendCtx.createLinearGradient(0, 0, legendCanvas.width, 0);
        for (let i = 0; i <= 100; i++) {
            const value = minVal + (i / 100) * (maxVal - minVal);
            const color = valueToColor(value, minVal, maxVal, hue);
            gradient.addColorStop(i / 100, color);
        }

        legendCtx.fillStyle = gradient;
        legendCtx.fillRect(0, 0, legendCanvas.width, legendCanvas.height);

        // Add text labels for min and max values
        legendCtx.fillStyle = 'black';
        legendCtx.font = '14px Arial';
        legendCtx.fontWeight = 'bold';
        legendCtx.fillText(minVal.toFixed(2), 0, legendCanvas.height - 3);
        legendCtx.fillText(maxVal.toFixed(2), legendCanvas.width - 30, legendCanvas.height - 3);
    }

    function updateLegend() {
        const minVal = minVals[currentMatrixIndex];
        const maxVal = maxVals[currentMatrixIndex];
        const hue = hues[currentMatrixIndex];
        drawLegend(minVal, maxVal, hue);
    }

    function toggleFixMatrix(matrixIndex) {
        if (fixedMatrixIndex === matrixIndex) {
            fixedMatrixIndex = null;
            document.getElementById('button' + matrixIndex).classList.remove('neon');
        } else {
            fixedMatrixIndex = matrixIndex;
            // Remove neon effect from all buttons
            for (let i = 0; i < matrices.length; i++) {
                document.getElementById('button' + i).classList.remove('neon');
            }
            // Add neon effect to the selected button
            document.getElementById('button' + matrixIndex).classList.add('neon');
        }
        drawMatrix(matrixIndex);
    }

    function highlightRowOrColumnAndToken(index) {
        if (currentMode === 'row') {
            highlightRow(index);
        } else {
            highlightColumn(index);
        }
        highlightToken(index);
    }

    function highlightRow(rowIndex) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        drawMatrix(matrixIndex, rowIndex);
    }

    function highlightColumn(colIndex) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        drawMatrix(matrixIndex, colIndex);
    }

    function highlightToken(index) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        let values;
        if (currentMode === 'row') {
            values = matrices[matrixIndex][index];
        } else {
            values = matrices[matrixIndex].map(row => row[index]);
        }
        for (let i = 0; i < values.length; i++) {
            const tokenElem = document.getElementById('token' + i);
            tokenElem.style.backgroundColor = valueToColor(values[i], minVal, maxVal, hue);
        }
    }

    function toggleFixRowOrColumn(index) {
        if (fixedMatrixIndex !== null) {
            if (currentMode === 'row') {
                highlightRow(index);
            } else {
                highlightColumn(index);
            }
        }
    }

    function drawPreview(matrixIndex) {
        const previewCanvas = document.getElementById('previewCanvas' + matrixIndex);
        const previewCtx = previewCanvas.getContext('2d');
        const data = matrices[matrixIndex];
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        const previewRows = previewCanvas.height;
        const previewCols = previewCanvas.width;
        const cellHeight = Math.max(previewCanvas.height / data.length, 2);
        const cellWidth = Math.max(previewCanvas.width / data[0].length, 2);
        const maxIndex = Math.min(previewRows / cellWidth, data.length);
        console.log(cellWidth, cellHeight, maxIndex)
        for (let i = 0; i < maxIndex; i++) {
            for (let j = 0; j < maxIndex; j++) {
                previewCtx.fillStyle = valueToColor(data[i][j], minVal, maxVal, hue);
                previewCtx.fillRect(j * cellWidth, i * cellHeight, cellWidth, cellHeight);
            }
        }
    }

    function setMode(mode) {
        currentMode = mode;
        document.getElementById('rowMode').classList.toggle('active', mode === 'row');
        document.getElementById('columnMode').classList.toggle('active', mode === 'column');
        // Redraw the matrix to update the neon effect
        drawMatrix(currentMatrixIndex);
        updateLegend();
    }

    // Draw previews
    for (let i = 0; i < matrices.length; i++) {
        drawPreview(i);
    }

    // Initial display
    showMatrix(currentMatrixIndex);
</script>
</body>
</html>
    