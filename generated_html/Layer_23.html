
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Matrix Heatmap</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        .viewer {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }
        #buttons {
            margin-bottom: 10px;
        }
        .button {
            display: inline-block;
            margin-right: 5px;
            cursor: pointer;
            text-align: center;
        }
        .button {
            border: 1px solid black;
        }
        .button.neon {
            box-shadow: 0 0 10px #00f, 0 0 20px #00f, 0 0 30px #00f, 0 0 40px #00f;
        }
        .token {
            display: inline-block;
            cursor: pointer;
            margin: 2px 0;
            padding: 2px 5px;
        }
        .token:hover {
            text-decoration: underline;
        }
        #tokens {
            margin-left: 20px;
            word-wrap: break-word;
            font-size: 30px;
        }
        .canvas-wrapper {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: min(75vw, 75vh);
            height: min(75vw, 75vh);
        }
        canvas {
            width: 100%;
            height: 100%;
        }
        .token-viewer {
            display: flex;
            flex-direction: column;
            justify-content: top;
            align-items: center;
            height: 75vh;
            overflow-y: auto;
        }
        .mode-buttons {
            margin-bottom: 10px;
        }
        .mode-button {
            cursor: pointer;
            padding: 5px 10px;
            margin-right: 5px;
            border: 1px solid black;
            border-radius: 3px;
        }
        .mode-button.active {
            background-color: #00f;
            color: #fff;
        }
        .legend {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
        }

        .legend canvas {
            border: 1px solid black;
        }

    </style>
</head>
<body>
<div id="buttons">
    <div class="button" id="button0" onmouseover="showMatrix(0, true)" onclick="toggleFixMatrix(0)"><canvas id="previewCanvas0" width="50" height="50"></canvas><br>Head 0</div><div class="button" id="button1" onmouseover="showMatrix(1, true)" onclick="toggleFixMatrix(1)"><canvas id="previewCanvas1" width="50" height="50"></canvas><br>Head 1</div><div class="button" id="button2" onmouseover="showMatrix(2, true)" onclick="toggleFixMatrix(2)"><canvas id="previewCanvas2" width="50" height="50"></canvas><br>Head 2</div><div class="button" id="button3" onmouseover="showMatrix(3, true)" onclick="toggleFixMatrix(3)"><canvas id="previewCanvas3" width="50" height="50"></canvas><br>Head 3</div><div class="button" id="button4" onmouseover="showMatrix(4, true)" onclick="toggleFixMatrix(4)"><canvas id="previewCanvas4" width="50" height="50"></canvas><br>Head 4</div><div class="button" id="button5" onmouseover="showMatrix(5, true)" onclick="toggleFixMatrix(5)"><canvas id="previewCanvas5" width="50" height="50"></canvas><br>Head 5</div><div class="button" id="button6" onmouseover="showMatrix(6, true)" onclick="toggleFixMatrix(6)"><canvas id="previewCanvas6" width="50" height="50"></canvas><br>Head 6</div><div class="button" id="button7" onmouseover="showMatrix(7, true)" onclick="toggleFixMatrix(7)"><canvas id="previewCanvas7" width="50" height="50"></canvas><br>Head 7</div><div class="button" id="button8" onmouseover="showMatrix(8, true)" onclick="toggleFixMatrix(8)"><canvas id="previewCanvas8" width="50" height="50"></canvas><br>Head 8</div><div class="button" id="button9" onmouseover="showMatrix(9, true)" onclick="toggleFixMatrix(9)"><canvas id="previewCanvas9" width="50" height="50"></canvas><br>Head 9</div><div class="button" id="button10" onmouseover="showMatrix(10, true)" onclick="toggleFixMatrix(10)"><canvas id="previewCanvas10" width="50" height="50"></canvas><br>Head 10</div><div class="button" id="button11" onmouseover="showMatrix(11, true)" onclick="toggleFixMatrix(11)"><canvas id="previewCanvas11" width="50" height="50"></canvas><br>Head 11</div><div class="button" id="button12" onmouseover="showMatrix(12, true)" onclick="toggleFixMatrix(12)"><canvas id="previewCanvas12" width="50" height="50"></canvas><br>Head 12</div><div class="button" id="button13" onmouseover="showMatrix(13, true)" onclick="toggleFixMatrix(13)"><canvas id="previewCanvas13" width="50" height="50"></canvas><br>Head 13</div><div class="button" id="button14" onmouseover="showMatrix(14, true)" onclick="toggleFixMatrix(14)"><canvas id="previewCanvas14" width="50" height="50"></canvas><br>Head 14</div><div class="button" id="button15" onmouseover="showMatrix(15, true)" onclick="toggleFixMatrix(15)"><canvas id="previewCanvas15" width="50" height="50"></canvas><br>Head 15</div><div class="button" id="button16" onmouseover="showMatrix(16, true)" onclick="toggleFixMatrix(16)"><canvas id="previewCanvas16" width="50" height="50"></canvas><br>Head 16</div><div class="button" id="button17" onmouseover="showMatrix(17, true)" onclick="toggleFixMatrix(17)"><canvas id="previewCanvas17" width="50" height="50"></canvas><br>Head 17</div><div class="button" id="button18" onmouseover="showMatrix(18, true)" onclick="toggleFixMatrix(18)"><canvas id="previewCanvas18" width="50" height="50"></canvas><br>Head 18</div><div class="button" id="button19" onmouseover="showMatrix(19, true)" onclick="toggleFixMatrix(19)"><canvas id="previewCanvas19" width="50" height="50"></canvas><br>Head 19</div>
</div>
<div class="viewer">
    <div class="canvas-wrapper">
        <canvas id="heatmapCanvas"></canvas>
        <div class="legend">
            <canvas id="legendCanvas" width="200" height="20"></canvas>
        </div>
    </div>
    <div class="token-viewer">
        <div class="mode-buttons">
            <div class="mode-button active" id="rowMode" onclick="setMode('row')">Row Mode</div>
            <div class="mode-button" id="columnMode" onclick="setMode('column')">Column Mode</div>
        </div>
        <div id="tokens">
            <span class="token" id="token0" onmouseover="highlightRowOrColumnAndToken(0)" onclick="toggleFixRowOrColumn(0)">&lt;|endoftext|&gt;</span><span class="token" id="token1" onmouseover="highlightRowOrColumnAndToken(1)" onclick="toggleFixRowOrColumn(1)">def</span><span class="token" id="token2" onmouseover="highlightRowOrColumnAndToken(2)" onclick="toggleFixRowOrColumn(2)">&nbsp;main</span><span class="token" id="token3" onmouseover="highlightRowOrColumnAndToken(3)" onclick="toggleFixRowOrColumn(3)">():</span><span class="token" id="token4" onmouseover="highlightRowOrColumnAndToken(4)" onclick="toggleFixRowOrColumn(4)">www</span>
        </div>
    </div>
</div>
<script>
    const canvas = document.getElementById('heatmapCanvas');
    const ctx = canvas.getContext('2d');
    const matrices = [[[1.0, 0.0, 0.0, 0.0, 0.0], [0.9128788709640503, 0.0871211588382721, 0.0, 0.0, 0.0], [0.6390624642372131, 0.12734387814998627, 0.2335936576128006, 0.0, 0.0], [0.13571849465370178, 0.09036360681056976, 0.09633928537368774, 0.6775786280632019, 0.0], [0.24268317222595215, 0.008918555453419685, 0.026850605383515358, 0.5201804637908936, 0.20136721432209015]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.59578937292099, 0.4042105972766876, 0.0, 0.0, 0.0], [0.24897347390651703, 0.6822848916053772, 0.06874173134565353, 0.0, 0.0], [0.053272832185029984, 0.049624230712652206, 0.0024540915619581938, 0.8946488499641418, 0.0], [0.13049432635307312, 0.19788603484630585, 0.014485855586826801, 0.5901363492012024, 0.06699743866920471]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.5691760778427124, 0.4308239221572876, 0.0, 0.0, 0.0], [0.3505118787288666, 0.38038569688796997, 0.26910245418548584, 0.0, 0.0], [0.28175291419029236, 0.14359338581562042, 0.2899785041809082, 0.2846751809120178, 0.0], [0.2275211066007614, 0.2531622648239136, 0.27604642510414124, 0.16127543151378632, 0.08199478685855865]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.3223518431186676, 0.6776481866836548, 0.0, 0.0, 0.0], [0.08508670330047607, 0.5155127048492432, 0.39940062165260315, 0.0, 0.0], [0.01574171893298626, 0.03013100102543831, 0.010957051999866962, 0.9431702494621277, 0.0], [0.05294134467840195, 0.2240268737077713, 0.04167767986655235, 0.6207022666931152, 0.06065182015299797]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9403067827224731, 0.059693217277526855, 0.0, 0.0, 0.0], [0.9492709040641785, 0.011903664097189903, 0.0388253778219223, 0.0, 0.0], [0.6403114199638367, 0.025145746767520905, 0.07362950593233109, 0.26091331243515015, 0.0], [0.5335308313369751, 0.04775627702474594, 0.15041325986385345, 0.2541842460632324, 0.014115354977548122]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.17690634727478027, 0.8230936527252197, 0.0, 0.0, 0.0], [0.7157815098762512, 0.24757051467895508, 0.0366479717195034, 0.0, 0.0], [0.7062211632728577, 0.019645942375063896, 0.14273925125598907, 0.13139371573925018, 0.0], [0.15908223390579224, 0.061400219798088074, 0.018863249570131302, 0.1847246140241623, 0.5759297013282776]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.7845585942268372, 0.21544140577316284, 0.0, 0.0, 0.0], [0.1789804846048355, 0.7471293210983276, 0.07389011234045029, 0.0, 0.0], [0.11843431740999222, 0.2303856909275055, 0.15573474764823914, 0.49544525146484375, 0.0], [0.010259200818836689, 0.04409012198448181, 0.05231795459985733, 0.8852546215057373, 0.008078056387603283]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9382123351097107, 0.06178762763738632, 0.0, 0.0, 0.0], [0.8074184060096741, 0.06683915108442307, 0.12574239075183868, 0.0, 0.0], [0.5081675052642822, 0.03277110308408737, 0.18056966364383698, 0.27849170565605164, 0.0], [0.4002091586589813, 0.05175330117344856, 0.05197865515947342, 0.29791614413261414, 0.19814278185367584]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.7516982555389404, 0.24830171465873718, 0.0, 0.0, 0.0], [0.5804871916770935, 0.08392005413770676, 0.3355928063392639, 0.0, 0.0], [0.10519489645957947, 0.03631388768553734, 0.508346676826477, 0.35014456510543823, 0.0], [0.1637222170829773, 0.020401084795594215, 0.13835181295871735, 0.1965382844209671, 0.48098671436309814]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.6993764042854309, 0.3006235957145691, 0.0, 0.0, 0.0], [0.8110901713371277, 0.06528419256210327, 0.12362561374902725, 0.0, 0.0], [0.3146913945674896, 0.0572233609855175, 0.5425249338150024, 0.08556030690670013, 0.0], [0.22439436614513397, 0.032840460538864136, 0.07552491128444672, 0.07681000232696533, 0.5904302597045898]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.7489013671875, 0.2510986626148224, 0.0, 0.0, 0.0], [0.6504602432250977, 0.30218398571014404, 0.04735581576824188, 0.0, 0.0], [0.528607189655304, 0.0018428637413308024, 0.021152401342988014, 0.44839754700660706, 0.0], [0.01212244387716055, 0.002030355855822563, 0.0028568077832460403, 0.9648316502571106, 0.018158774822950363]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.6920693516731262, 0.3079306483268738, 0.0, 0.0, 0.0], [0.3322416841983795, 0.5269911885261536, 0.14076711237430573, 0.0, 0.0], [0.36120760440826416, 0.11876275390386581, 0.08240902423858643, 0.437620609998703, 0.0], [0.17168454825878143, 0.12901130318641663, 0.020416250452399254, 0.4161534905433655, 0.26273438334465027]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9504863023757935, 0.04951371252536774, 0.0, 0.0, 0.0], [0.9066733121871948, 0.04051858186721802, 0.052808117121458054, 0.0, 0.0], [0.7198682427406311, 0.038987502455711365, 0.17087700963020325, 0.07026731967926025, 0.0], [0.15074467658996582, 0.004302548244595528, 0.011985043063759804, 0.044350966811180115, 0.7886167764663696]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8680481910705566, 0.13195180892944336, 0.0, 0.0, 0.0], [0.9114073514938354, 0.02061363495886326, 0.06797903776168823, 0.0, 0.0], [0.6953327655792236, 0.1255672127008438, 0.07317079603672028, 0.10592923313379288, 0.0], [0.4499351680278778, 0.05814375728368759, 0.03796697035431862, 0.17387430369853973, 0.2800798714160919]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.12034303694963455, 0.8796569108963013, 0.0, 0.0, 0.0], [0.3314064145088196, 0.32472407817840576, 0.34386947751045227, 0.0, 0.0], [0.24682272970676422, 0.20760048925876617, 0.3106202483177185, 0.23495657742023468, 0.0], [0.1709306836128235, 0.0817340761423111, 0.3449627459049225, 0.1308939903974533, 0.2714785039424896]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9580362439155579, 0.04196379333734512, 0.0, 0.0, 0.0], [0.5619641542434692, 0.09903593361377716, 0.3389999270439148, 0.0, 0.0], [0.3127424418926239, 0.18260447680950165, 0.0021327673457562923, 0.5025203227996826, 0.0], [0.5377561450004578, 0.04845346510410309, 0.05884325131773949, 0.2984539568424225, 0.056493278592824936]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9463618397712708, 0.05363813415169716, 0.0, 0.0, 0.0], [0.8913702368736267, 0.0653245821595192, 0.04330514371395111, 0.0, 0.0], [0.07064352184534073, 0.0742606520652771, 0.040455181151628494, 0.8146406412124634, 0.0], [0.15152737498283386, 0.12894365191459656, 0.0913996547460556, 0.5747305750846863, 0.0533987395465374]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.32762983441352844, 0.6723701357841492, 0.0, 0.0, 0.0], [0.23297128081321716, 0.12341181188821793, 0.6436169147491455, 0.0, 0.0], [0.09533998370170593, 0.07650730013847351, 0.30655384063720703, 0.5215988755226135, 0.0], [0.128017857670784, 0.17254015803337097, 0.20783475041389465, 0.31648001074790955, 0.17512717843055725]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.008554038591682911, 0.9914459586143494, 0.0, 0.0, 0.0], [0.003001114586368203, 0.9871404767036438, 0.009858416393399239, 0.0, 0.0], [0.0072894347831606865, 0.6796689629554749, 0.20962102711200714, 0.10342060774564743, 0.0], [0.007615487091243267, 0.28236404061317444, 0.01767011545598507, 0.469362735748291, 0.22298769652843475]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8641030788421631, 0.1358969360589981, 0.0, 0.0, 0.0], [0.7815316319465637, 0.04229284077882767, 0.17617550492286682, 0.0, 0.0], [0.52043217420578, 0.02632240764796734, 0.15936389565467834, 0.29388147592544556, 0.0], [0.3048510253429413, 0.024702202528715134, 0.06269193440675735, 0.1803901493549347, 0.427364706993103]]];
    const rows = 5;
    const cols = 5;
    const minVals = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0];
    const maxVals = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];
    const hues = [84, 246, 69, 176, 289, 338, 105, 226, 180, 265, 355, 3, 51, 332, 70, 266, 237, 211, 265, 262];
    let fixedMatrixIndex = null;
    let currentMatrixIndex = 0;
    let currentMode = 'row'; // Default mode
    const legendCanvas = document.getElementById('legendCanvas');
    const legendCtx = legendCanvas.getContext('2d');

    function resizeCanvas() {
        const canvasWrapper = document.querySelector('.canvas-wrapper');
        canvas.width = canvasWrapper.clientWidth;
        canvas.height = canvasWrapper.clientHeight;
        drawMatrix(currentMatrixIndex);
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function valueToColor(value, minVal, maxVal, hue, dim = false) {
        const normalizedValue = (value - minVal) / (maxVal - minVal);
        const lightness = 100 - Math.floor(normalizedValue * 75);  // lightness from 25% to 100%
        if (dim) {
            return `hsl(${hue}, 0%, ${lightness}%)`;  // Dim the brightness for non-highlighted rows
        }
        return `hsl(${hue}, 100%, ${lightness}%)`;
    }

    function drawMatrix(matrixIndex, highlightIndex = null) {
        const data = matrices[matrixIndex];
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        const currentRows = data.length;
        const currentCols = data[0].length;
        const cellWidth = Math.floor(canvas.width / currentCols);
        const cellHeight = Math.floor(canvas.height / currentRows);

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        for (let i = 0; i < currentRows; i++) {
            for (let j = 0; j < currentCols; j++) {
                let dim = false;
                if (highlightIndex !== null) {
                    if (currentMode === 'row' && i !== highlightIndex) {
                        dim = true;
                    } else if (currentMode === 'column' && j !== highlightIndex) {
                        dim = true;
                    }
                }
                ctx.fillStyle = valueToColor(data[i][j], minVal, maxVal, hue, dim);
                ctx.fillRect(j * cellWidth, i * cellHeight, cellWidth, cellHeight);
            }
        }
    }

    function showMatrix(matrixIndex, updateTokens = false) {
        currentMatrixIndex = matrixIndex;
        if (fixedMatrixIndex === null) {
            drawMatrix(matrixIndex);
        }
        if (updateTokens) {
            const rowOrColumn = matrices[matrixIndex][0];
            const minVal = minVals[matrixIndex];
            const maxVal = maxVals[matrixIndex];
            const hue = hues[matrixIndex];
            for (let i = 0; i < rowOrColumn.length; i++) {
                const tokenElem = document.getElementById('token' + i);
                tokenElem.style.backgroundColor = valueToColor(rowOrColumn[i], minVal, maxVal, hue);
            }
        }
        updateLegend();
    }
    
    function drawLegend(minVal, maxVal, hue) {
        const gradient = legendCtx.createLinearGradient(0, 0, legendCanvas.width, 0);
        for (let i = 0; i <= 100; i++) {
            const value = minVal + (i / 100) * (maxVal - minVal);
            const color = valueToColor(value, minVal, maxVal, hue);
            gradient.addColorStop(i / 100, color);
        }

        legendCtx.fillStyle = gradient;
        legendCtx.fillRect(0, 0, legendCanvas.width, legendCanvas.height);

        // Add text labels for min and max values
        legendCtx.fillStyle = 'black';
        legendCtx.font = '14px Arial';
        legendCtx.fontWeight = 'bold';
        legendCtx.fillText(minVal.toFixed(2), 0, legendCanvas.height - 3);
        legendCtx.fillText(maxVal.toFixed(2), legendCanvas.width - 30, legendCanvas.height - 3);
    }

    function updateLegend() {
        const minVal = minVals[currentMatrixIndex];
        const maxVal = maxVals[currentMatrixIndex];
        const hue = hues[currentMatrixIndex];
        drawLegend(minVal, maxVal, hue);
    }

    function toggleFixMatrix(matrixIndex) {
        if (fixedMatrixIndex === matrixIndex) {
            fixedMatrixIndex = null;
            document.getElementById('button' + matrixIndex).classList.remove('neon');
        } else {
            fixedMatrixIndex = matrixIndex;
            // Remove neon effect from all buttons
            for (let i = 0; i < matrices.length; i++) {
                document.getElementById('button' + i).classList.remove('neon');
            }
            // Add neon effect to the selected button
            document.getElementById('button' + matrixIndex).classList.add('neon');
        }
        drawMatrix(matrixIndex);
    }

    function highlightRowOrColumnAndToken(index) {
        if (currentMode === 'row') {
            highlightRow(index);
        } else {
            highlightColumn(index);
        }
        highlightToken(index);
    }

    function highlightRow(rowIndex) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        drawMatrix(matrixIndex, rowIndex);
    }

    function highlightColumn(colIndex) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        drawMatrix(matrixIndex, colIndex);
    }

    function highlightToken(index) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        let values;
        if (currentMode === 'row') {
            values = matrices[matrixIndex][index];
        } else {
            values = matrices[matrixIndex].map(row => row[index]);
        }
        for (let i = 0; i < values.length; i++) {
            const tokenElem = document.getElementById('token' + i);
            tokenElem.style.backgroundColor = valueToColor(values[i], minVal, maxVal, hue);
        }
    }

    function toggleFixRowOrColumn(index) {
        if (fixedMatrixIndex !== null) {
            if (currentMode === 'row') {
                highlightRow(index);
            } else {
                highlightColumn(index);
            }
        }
    }

    function drawPreview(matrixIndex) {
        const previewCanvas = document.getElementById('previewCanvas' + matrixIndex);
        const previewCtx = previewCanvas.getContext('2d');
        const data = matrices[matrixIndex];
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        const previewRows = previewCanvas.height;
        const previewCols = previewCanvas.width;
        const cellHeight = Math.max(previewCanvas.height / data.length, 2);
        const cellWidth = Math.max(previewCanvas.width / data[0].length, 2);
        const maxIndex = Math.min(previewRows / cellWidth, data.length);
        console.log(cellWidth, cellHeight, maxIndex)
        for (let i = 0; i < maxIndex; i++) {
            for (let j = 0; j < maxIndex; j++) {
                previewCtx.fillStyle = valueToColor(data[i][j], minVal, maxVal, hue);
                previewCtx.fillRect(j * cellWidth, i * cellHeight, cellWidth, cellHeight);
            }
        }
    }

    function setMode(mode) {
        currentMode = mode;
        document.getElementById('rowMode').classList.toggle('active', mode === 'row');
        document.getElementById('columnMode').classList.toggle('active', mode === 'column');
        // Redraw the matrix to update the neon effect
        drawMatrix(currentMatrixIndex);
        updateLegend();
    }

    // Draw previews
    for (let i = 0; i < matrices.length; i++) {
        drawPreview(i);
    }

    // Initial display
    showMatrix(currentMatrixIndex);
</script>
</body>
</html>
    