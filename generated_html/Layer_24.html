
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Matrix Heatmap</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        .viewer {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }
        #buttons {
            margin-bottom: 10px;
        }
        .button {
            display: inline-block;
            margin-right: 5px;
            cursor: pointer;
            text-align: center;
        }
        .button {
            border: 1px solid black;
        }
        .button.neon {
            box-shadow: 0 0 10px #00f, 0 0 20px #00f, 0 0 30px #00f, 0 0 40px #00f;
        }
        .token {
            display: inline-block;
            cursor: pointer;
            margin: 2px 0;
            padding: 2px 5px;
        }
        .token:hover {
            text-decoration: underline;
        }
        #tokens {
            margin-left: 20px;
            word-wrap: break-word;
            font-size: 30px;
        }
        .canvas-wrapper {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: min(75vw, 75vh);
            height: min(75vw, 75vh);
        }
        canvas {
            width: 100%;
            height: 100%;
        }
        .token-viewer {
            display: flex;
            flex-direction: column;
            justify-content: top;
            align-items: center;
            height: 75vh;
            overflow-y: auto;
        }
        .mode-buttons {
            margin-bottom: 10px;
        }
        .mode-button {
            cursor: pointer;
            padding: 5px 10px;
            margin-right: 5px;
            border: 1px solid black;
            border-radius: 3px;
        }
        .mode-button.active {
            background-color: #00f;
            color: #fff;
        }
        .legend {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
        }

        .legend canvas {
            border: 1px solid black;
        }

    </style>
</head>
<body>
<div id="buttons">
    <div class="button" id="button0" onmouseover="showMatrix(0, true)" onclick="toggleFixMatrix(0)"><canvas id="previewCanvas0" width="50" height="50"></canvas><br>Head 0</div><div class="button" id="button1" onmouseover="showMatrix(1, true)" onclick="toggleFixMatrix(1)"><canvas id="previewCanvas1" width="50" height="50"></canvas><br>Head 1</div><div class="button" id="button2" onmouseover="showMatrix(2, true)" onclick="toggleFixMatrix(2)"><canvas id="previewCanvas2" width="50" height="50"></canvas><br>Head 2</div><div class="button" id="button3" onmouseover="showMatrix(3, true)" onclick="toggleFixMatrix(3)"><canvas id="previewCanvas3" width="50" height="50"></canvas><br>Head 3</div><div class="button" id="button4" onmouseover="showMatrix(4, true)" onclick="toggleFixMatrix(4)"><canvas id="previewCanvas4" width="50" height="50"></canvas><br>Head 4</div><div class="button" id="button5" onmouseover="showMatrix(5, true)" onclick="toggleFixMatrix(5)"><canvas id="previewCanvas5" width="50" height="50"></canvas><br>Head 5</div><div class="button" id="button6" onmouseover="showMatrix(6, true)" onclick="toggleFixMatrix(6)"><canvas id="previewCanvas6" width="50" height="50"></canvas><br>Head 6</div><div class="button" id="button7" onmouseover="showMatrix(7, true)" onclick="toggleFixMatrix(7)"><canvas id="previewCanvas7" width="50" height="50"></canvas><br>Head 7</div><div class="button" id="button8" onmouseover="showMatrix(8, true)" onclick="toggleFixMatrix(8)"><canvas id="previewCanvas8" width="50" height="50"></canvas><br>Head 8</div><div class="button" id="button9" onmouseover="showMatrix(9, true)" onclick="toggleFixMatrix(9)"><canvas id="previewCanvas9" width="50" height="50"></canvas><br>Head 9</div><div class="button" id="button10" onmouseover="showMatrix(10, true)" onclick="toggleFixMatrix(10)"><canvas id="previewCanvas10" width="50" height="50"></canvas><br>Head 10</div><div class="button" id="button11" onmouseover="showMatrix(11, true)" onclick="toggleFixMatrix(11)"><canvas id="previewCanvas11" width="50" height="50"></canvas><br>Head 11</div><div class="button" id="button12" onmouseover="showMatrix(12, true)" onclick="toggleFixMatrix(12)"><canvas id="previewCanvas12" width="50" height="50"></canvas><br>Head 12</div><div class="button" id="button13" onmouseover="showMatrix(13, true)" onclick="toggleFixMatrix(13)"><canvas id="previewCanvas13" width="50" height="50"></canvas><br>Head 13</div><div class="button" id="button14" onmouseover="showMatrix(14, true)" onclick="toggleFixMatrix(14)"><canvas id="previewCanvas14" width="50" height="50"></canvas><br>Head 14</div><div class="button" id="button15" onmouseover="showMatrix(15, true)" onclick="toggleFixMatrix(15)"><canvas id="previewCanvas15" width="50" height="50"></canvas><br>Head 15</div><div class="button" id="button16" onmouseover="showMatrix(16, true)" onclick="toggleFixMatrix(16)"><canvas id="previewCanvas16" width="50" height="50"></canvas><br>Head 16</div><div class="button" id="button17" onmouseover="showMatrix(17, true)" onclick="toggleFixMatrix(17)"><canvas id="previewCanvas17" width="50" height="50"></canvas><br>Head 17</div><div class="button" id="button18" onmouseover="showMatrix(18, true)" onclick="toggleFixMatrix(18)"><canvas id="previewCanvas18" width="50" height="50"></canvas><br>Head 18</div><div class="button" id="button19" onmouseover="showMatrix(19, true)" onclick="toggleFixMatrix(19)"><canvas id="previewCanvas19" width="50" height="50"></canvas><br>Head 19</div>
</div>
<div class="viewer">
    <div class="canvas-wrapper">
        <canvas id="heatmapCanvas"></canvas>
        <div class="legend">
            <canvas id="legendCanvas" width="200" height="20"></canvas>
        </div>
    </div>
    <div class="token-viewer">
        <div class="mode-buttons">
            <div class="mode-button active" id="rowMode" onclick="setMode('row')">Row Mode</div>
            <div class="mode-button" id="columnMode" onclick="setMode('column')">Column Mode</div>
        </div>
        <div id="tokens">
            <span class="token" id="token0" onmouseover="highlightRowOrColumnAndToken(0)" onclick="toggleFixRowOrColumn(0)">&lt;|endoftext|&gt;</span><span class="token" id="token1" onmouseover="highlightRowOrColumnAndToken(1)" onclick="toggleFixRowOrColumn(1)">def</span><span class="token" id="token2" onmouseover="highlightRowOrColumnAndToken(2)" onclick="toggleFixRowOrColumn(2)">&nbsp;main</span><span class="token" id="token3" onmouseover="highlightRowOrColumnAndToken(3)" onclick="toggleFixRowOrColumn(3)">():</span><span class="token" id="token4" onmouseover="highlightRowOrColumnAndToken(4)" onclick="toggleFixRowOrColumn(4)">www</span>
        </div>
    </div>
</div>
<script>
    const canvas = document.getElementById('heatmapCanvas');
    const ctx = canvas.getContext('2d');
    const matrices = [[[1.0, 0.0, 0.0, 0.0, 0.0], [0.00390905886888504, 0.9960909485816956, 0.0, 0.0, 0.0], [0.0003622066869866103, 0.987147867679596, 0.012489884160459042, 0.0, 0.0], [0.00038165305159054697, 0.9203566908836365, 0.00286631821654737, 0.07639531046152115, 0.0], [0.024288229644298553, 0.5994672775268555, 0.03233214467763901, 0.3124507665634155, 0.03146157041192055]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.6935781240463257, 0.3064218759536743, 0.0, 0.0, 0.0], [0.7523056268692017, 0.18941543996334076, 0.05827890709042549, 0.0, 0.0], [0.6465709209442139, 0.15477707982063293, 0.056527458131313324, 0.14212451875209808, 0.0], [0.5003208518028259, 0.03525841236114502, 0.04891118407249451, 0.09509536623954773, 0.320414274930954]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.7434781193733215, 0.2565218210220337, 0.0, 0.0, 0.0], [0.7802899479866028, 0.06857042014598846, 0.15113958716392517, 0.0, 0.0], [0.18785099685192108, 0.028996942564845085, 0.7556813359260559, 0.02747071348130703, 0.0], [0.3837151825428009, 0.06914027035236359, 0.18673773109912872, 0.038034241646528244, 0.3223726451396942]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.47672727704048157, 0.5232727527618408, 0.0, 0.0, 0.0], [0.047208599746227264, 0.8998032212257385, 0.0529881976544857, 0.0, 0.0], [0.17064934968948364, 0.6200411915779114, 0.03226259723305702, 0.17704685032367706, 0.0], [0.31603944301605225, 0.21007823944091797, 0.01617889665067196, 0.16771167516708374, 0.28999170660972595]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.3575397729873657, 0.6424602270126343, 0.0, 0.0, 0.0], [0.050478219985961914, 0.1703946590423584, 0.7791271209716797, 0.0, 0.0], [0.12375397980213165, 0.09873995184898376, 0.5253877639770508, 0.2521182894706726, 0.0], [0.3613795340061188, 0.07825697958469391, 0.23397769033908844, 0.2287101298570633, 0.09767566621303558]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9148770570755005, 0.08512289822101593, 0.0, 0.0, 0.0], [0.5282019972801208, 0.10059771686792374, 0.3712003231048584, 0.0, 0.0], [0.3518306314945221, 0.05018632113933563, 0.040776874870061874, 0.5572062730789185, 0.0], [0.27013567090034485, 0.017040561884641647, 0.038749366998672485, 0.4088165760040283, 0.2652578055858612]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.6722831130027771, 0.3277168869972229, 0.0, 0.0, 0.0], [0.4458777904510498, 0.2952767014503479, 0.2588455080986023, 0.0, 0.0], [0.6267882585525513, 0.05748854950070381, 0.11433261632919312, 0.20139053463935852, 0.0], [0.24731265008449554, 0.1399582475423813, 0.08261056244373322, 0.024840500205755234, 0.5052780508995056]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.5641158223152161, 0.4358842074871063, 0.0, 0.0, 0.0], [0.4974624216556549, 0.16982586681842804, 0.33271172642707825, 0.0, 0.0], [0.485429972410202, 0.43110430240631104, 0.044620342552661896, 0.038845423609018326, 0.0], [0.5650855302810669, 0.1115228533744812, 0.15791217982769012, 0.0764729380607605, 0.08900649100542068]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9777897596359253, 0.022210201248526573, 0.0, 0.0, 0.0], [0.8266895413398743, 0.0357963964343071, 0.13751401007175446, 0.0, 0.0], [0.39872822165489197, 0.07701430469751358, 0.3012333810329437, 0.22302410006523132, 0.0], [0.6011397838592529, 0.0183402206748724, 0.08466552197933197, 0.08826348930597305, 0.2075909823179245]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.2869247496128082, 0.7130752801895142, 0.0, 0.0, 0.0], [0.44781506061553955, 0.24297241866588593, 0.30921250581741333, 0.0, 0.0], [0.34633466601371765, 0.03197148069739342, 0.49921727180480957, 0.12247652560472488, 0.0], [0.5620714426040649, 0.02974625490605831, 0.21210341155529022, 0.08418110013008118, 0.1118977889418602]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.5799531936645508, 0.42004677653312683, 0.0, 0.0, 0.0], [0.29513055086135864, 0.13544784486293793, 0.5694215893745422, 0.0, 0.0], [0.030203649774193764, 0.00734652578830719, 0.05913150683045387, 0.9033183455467224, 0.0], [0.1274598091840744, 0.03997322544455528, 0.25800010561943054, 0.3005068004131317, 0.27406007051467896]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9411538243293762, 0.058846164494752884, 0.0, 0.0, 0.0], [0.7549558281898499, 0.02085915207862854, 0.224185049533844, 0.0, 0.0], [0.15133313834667206, 0.06309032440185547, 0.4388008415699005, 0.3467756509780884, 0.0], [0.38704124093055725, 0.02824828214943409, 0.10583417862653732, 0.12400488555431366, 0.3548714220523834]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8339210152626038, 0.16607902944087982, 0.0, 0.0, 0.0], [0.7313964366912842, 0.1793718785047531, 0.08923174440860748, 0.0, 0.0], [0.37948110699653625, 0.06965333968400955, 0.026235025376081467, 0.5246305465698242, 0.0], [0.32124584913253784, 0.04753287881612778, 0.03460422530770302, 0.5360280871391296, 0.060589034110307693]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.5995461940765381, 0.40045374631881714, 0.0, 0.0, 0.0], [0.7779774069786072, 0.1424986869096756, 0.07952381670475006, 0.0, 0.0], [0.5688902735710144, 0.18225638568401337, 0.0790841281414032, 0.16976916790008545, 0.0], [0.4667438566684723, 0.1377071887254715, 0.03810775279998779, 0.12479332089424133, 0.2326478660106659]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.6595203876495361, 0.3404795825481415, 0.0, 0.0, 0.0], [0.6257309913635254, 0.2567139267921448, 0.11755504459142685, 0.0, 0.0], [0.7372016906738281, 0.0910196453332901, 0.09673098474740982, 0.07504763454198837, 0.0], [0.24838225543498993, 0.03240527957677841, 0.004497863352298737, 0.6711109280586243, 0.04360365495085716]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.491678923368454, 0.5083210468292236, 0.0, 0.0, 0.0], [0.23831231892108917, 0.6258931756019592, 0.1357945054769516, 0.0, 0.0], [0.08626693487167358, 0.8105124831199646, 0.015450640581548214, 0.08777005225419998, 0.0], [0.19173018634319305, 0.19045938551425934, 0.2313699871301651, 0.3646574020385742, 0.021783100441098213]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.5816770792007446, 0.4183228611946106, 0.0, 0.0, 0.0], [0.8746612071990967, 0.0878085270524025, 0.037530191242694855, 0.0, 0.0], [0.1731046885251999, 0.1378023624420166, 0.5360806584358215, 0.15301232039928436, 0.0], [0.45621612668037415, 0.06033195182681084, 0.079716257750988, 0.15857715904712677, 0.24515849351882935]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.40869322419166565, 0.5913068652153015, 0.0, 0.0, 0.0], [0.39660176634788513, 0.4677031338214874, 0.13569512963294983, 0.0, 0.0], [0.16322796046733856, 0.5084089636802673, 0.06271426379680634, 0.265648752450943, 0.0], [0.19361436367034912, 0.26311951875686646, 0.14773692190647125, 0.22572098672389984, 0.16980811953544617]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.1617221087217331, 0.8382778763771057, 0.0, 0.0, 0.0], [0.346986323595047, 0.4853416085243225, 0.16767199337482452, 0.0, 0.0], [0.1752844601869583, 0.412656307220459, 0.06277001649141312, 0.349289208650589, 0.0], [0.06371709704399109, 0.006688402965664864, 0.029137881472706795, 0.0762108787894249, 0.8242457509040833]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8688437938690186, 0.13115622103214264, 0.0, 0.0, 0.0], [0.5565714240074158, 0.3516353666782379, 0.09179317206144333, 0.0, 0.0], [0.2192200869321823, 0.43621116876602173, 0.20749568939208984, 0.13707299530506134, 0.0], [0.33443278074264526, 0.0717155933380127, 0.0708896741271019, 0.07215949147939682, 0.4508024752140045]]];
    const rows = 5;
    const cols = 5;
    const minVals = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0];
    const maxVals = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];
    const hues = [328, 141, 316, 217, 19, 201, 95, 149, 249, 62, 329, 164, 346, 3, 74, 2, 77, 356, 185, 26];
    let fixedMatrixIndex = null;
    let currentMatrixIndex = 0;
    let currentMode = 'row'; // Default mode
    const legendCanvas = document.getElementById('legendCanvas');
    const legendCtx = legendCanvas.getContext('2d');

    function resizeCanvas() {
        const canvasWrapper = document.querySelector('.canvas-wrapper');
        canvas.width = canvasWrapper.clientWidth;
        canvas.height = canvasWrapper.clientHeight;
        drawMatrix(currentMatrixIndex);
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function valueToColor(value, minVal, maxVal, hue, dim = false) {
        const normalizedValue = (value - minVal) / (maxVal - minVal);
        const lightness = 100 - Math.floor(normalizedValue * 75);  // lightness from 25% to 100%
        if (dim) {
            return `hsl(${hue}, 0%, ${lightness}%)`;  // Dim the brightness for non-highlighted rows
        }
        return `hsl(${hue}, 100%, ${lightness}%)`;
    }

    function drawMatrix(matrixIndex, highlightIndex = null) {
        const data = matrices[matrixIndex];
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        const currentRows = data.length;
        const currentCols = data[0].length;
        const cellWidth = Math.floor(canvas.width / currentCols);
        const cellHeight = Math.floor(canvas.height / currentRows);

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        for (let i = 0; i < currentRows; i++) {
            for (let j = 0; j < currentCols; j++) {
                let dim = false;
                if (highlightIndex !== null) {
                    if (currentMode === 'row' && i !== highlightIndex) {
                        dim = true;
                    } else if (currentMode === 'column' && j !== highlightIndex) {
                        dim = true;
                    }
                }
                ctx.fillStyle = valueToColor(data[i][j], minVal, maxVal, hue, dim);
                ctx.fillRect(j * cellWidth, i * cellHeight, cellWidth, cellHeight);
            }
        }
    }

    function showMatrix(matrixIndex, updateTokens = false) {
        currentMatrixIndex = matrixIndex;
        if (fixedMatrixIndex === null) {
            drawMatrix(matrixIndex);
        }
        if (updateTokens) {
            const rowOrColumn = matrices[matrixIndex][0];
            const minVal = minVals[matrixIndex];
            const maxVal = maxVals[matrixIndex];
            const hue = hues[matrixIndex];
            for (let i = 0; i < rowOrColumn.length; i++) {
                const tokenElem = document.getElementById('token' + i);
                tokenElem.style.backgroundColor = valueToColor(rowOrColumn[i], minVal, maxVal, hue);
            }
        }
        updateLegend();
    }
    
    function drawLegend(minVal, maxVal, hue) {
        const gradient = legendCtx.createLinearGradient(0, 0, legendCanvas.width, 0);
        for (let i = 0; i <= 100; i++) {
            const value = minVal + (i / 100) * (maxVal - minVal);
            const color = valueToColor(value, minVal, maxVal, hue);
            gradient.addColorStop(i / 100, color);
        }

        legendCtx.fillStyle = gradient;
        legendCtx.fillRect(0, 0, legendCanvas.width, legendCanvas.height);

        // Add text labels for min and max values
        legendCtx.fillStyle = 'black';
        legendCtx.font = '14px Arial';
        legendCtx.fontWeight = 'bold';
        legendCtx.fillText(minVal.toFixed(2), 0, legendCanvas.height - 3);
        legendCtx.fillText(maxVal.toFixed(2), legendCanvas.width - 30, legendCanvas.height - 3);
    }

    function updateLegend() {
        const minVal = minVals[currentMatrixIndex];
        const maxVal = maxVals[currentMatrixIndex];
        const hue = hues[currentMatrixIndex];
        drawLegend(minVal, maxVal, hue);
    }

    function toggleFixMatrix(matrixIndex) {
        if (fixedMatrixIndex === matrixIndex) {
            fixedMatrixIndex = null;
            document.getElementById('button' + matrixIndex).classList.remove('neon');
        } else {
            fixedMatrixIndex = matrixIndex;
            // Remove neon effect from all buttons
            for (let i = 0; i < matrices.length; i++) {
                document.getElementById('button' + i).classList.remove('neon');
            }
            // Add neon effect to the selected button
            document.getElementById('button' + matrixIndex).classList.add('neon');
        }
        drawMatrix(matrixIndex);
    }

    function highlightRowOrColumnAndToken(index) {
        if (currentMode === 'row') {
            highlightRow(index);
        } else {
            highlightColumn(index);
        }
        highlightToken(index);
    }

    function highlightRow(rowIndex) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        drawMatrix(matrixIndex, rowIndex);
    }

    function highlightColumn(colIndex) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        drawMatrix(matrixIndex, colIndex);
    }

    function highlightToken(index) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        let values;
        if (currentMode === 'row') {
            values = matrices[matrixIndex][index];
        } else {
            values = matrices[matrixIndex].map(row => row[index]);
        }
        for (let i = 0; i < values.length; i++) {
            const tokenElem = document.getElementById('token' + i);
            tokenElem.style.backgroundColor = valueToColor(values[i], minVal, maxVal, hue);
        }
    }

    function toggleFixRowOrColumn(index) {
        if (fixedMatrixIndex !== null) {
            if (currentMode === 'row') {
                highlightRow(index);
            } else {
                highlightColumn(index);
            }
        }
    }

    function drawPreview(matrixIndex) {
        const previewCanvas = document.getElementById('previewCanvas' + matrixIndex);
        const previewCtx = previewCanvas.getContext('2d');
        const data = matrices[matrixIndex];
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        const previewRows = previewCanvas.height;
        const previewCols = previewCanvas.width;
        const cellHeight = Math.max(previewCanvas.height / data.length, 2);
        const cellWidth = Math.max(previewCanvas.width / data[0].length, 2);
        const maxIndex = Math.min(previewRows / cellWidth, data.length);
        console.log(cellWidth, cellHeight, maxIndex)
        for (let i = 0; i < maxIndex; i++) {
            for (let j = 0; j < maxIndex; j++) {
                previewCtx.fillStyle = valueToColor(data[i][j], minVal, maxVal, hue);
                previewCtx.fillRect(j * cellWidth, i * cellHeight, cellWidth, cellHeight);
            }
        }
    }

    function setMode(mode) {
        currentMode = mode;
        document.getElementById('rowMode').classList.toggle('active', mode === 'row');
        document.getElementById('columnMode').classList.toggle('active', mode === 'column');
        // Redraw the matrix to update the neon effect
        drawMatrix(currentMatrixIndex);
        updateLegend();
    }

    // Draw previews
    for (let i = 0; i < matrices.length; i++) {
        drawPreview(i);
    }

    // Initial display
    showMatrix(currentMatrixIndex);
</script>
</body>
</html>
    