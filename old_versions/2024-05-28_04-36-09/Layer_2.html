
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Matrix Heatmap</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        .viewer {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }
        #buttons {
            margin-bottom: 10px;
        }
        .button {
            display: inline-block;
            margin-right: 5px;
            cursor: pointer;
            text-align: center;
        }
        .button {
            border: 1px solid black;
        }
        .button.neon {
            box-shadow: 0 0 10px #00f, 0 0 20px #00f, 0 0 30px #00f, 0 0 40px #00f;
        }
        .token {
            display: inline-block;
            cursor: pointer;
            margin: 2px 0;
            padding: 2px 5px;
        }
        .token:hover {
            text-decoration: underline;
        }
        #tokens {
            margin-left: 20px;
            word-wrap: break-word;
            font-size: 30px;
        }
        .canvas-wrapper {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: min(75vw, 75vh);
            height: min(75vw, 75vh);
        }
        canvas {
            width: 100%;
            height: 100%;
        }
        .token-viewer {
            display: flex;
            flex-direction: column;
            justify-content: top;
            align-items: center;
            height: 75vh;
            overflow-y: auto;
        }
        .mode-buttons {
            margin-bottom: 10px;
        }
        .mode-button {
            cursor: pointer;
            padding: 5px 10px;
            margin-right: 5px;
            border: 1px solid black;
            border-radius: 3px;
        }
        .mode-button.active {
            background-color: #00f;
            color: #fff;
        }
        .legend {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
        }

        .legend canvas {
            border: 1px solid black;
        }

    </style>
</head>
<body>
<div id="buttons">
    <div class="button" id="button0" onmouseover="showMatrix(0, true)" onclick="toggleFixMatrix(0)"><canvas id="previewCanvas0" width="50" height="50"></canvas><br>Head 0</div><div class="button" id="button1" onmouseover="showMatrix(1, true)" onclick="toggleFixMatrix(1)"><canvas id="previewCanvas1" width="50" height="50"></canvas><br>Head 1</div><div class="button" id="button2" onmouseover="showMatrix(2, true)" onclick="toggleFixMatrix(2)"><canvas id="previewCanvas2" width="50" height="50"></canvas><br>Head 2</div><div class="button" id="button3" onmouseover="showMatrix(3, true)" onclick="toggleFixMatrix(3)"><canvas id="previewCanvas3" width="50" height="50"></canvas><br>Head 3</div><div class="button" id="button4" onmouseover="showMatrix(4, true)" onclick="toggleFixMatrix(4)"><canvas id="previewCanvas4" width="50" height="50"></canvas><br>Head 4</div><div class="button" id="button5" onmouseover="showMatrix(5, true)" onclick="toggleFixMatrix(5)"><canvas id="previewCanvas5" width="50" height="50"></canvas><br>Head 5</div><div class="button" id="button6" onmouseover="showMatrix(6, true)" onclick="toggleFixMatrix(6)"><canvas id="previewCanvas6" width="50" height="50"></canvas><br>Head 6</div><div class="button" id="button7" onmouseover="showMatrix(7, true)" onclick="toggleFixMatrix(7)"><canvas id="previewCanvas7" width="50" height="50"></canvas><br>Head 7</div><div class="button" id="button8" onmouseover="showMatrix(8, true)" onclick="toggleFixMatrix(8)"><canvas id="previewCanvas8" width="50" height="50"></canvas><br>Head 8</div><div class="button" id="button9" onmouseover="showMatrix(9, true)" onclick="toggleFixMatrix(9)"><canvas id="previewCanvas9" width="50" height="50"></canvas><br>Head 9</div><div class="button" id="button10" onmouseover="showMatrix(10, true)" onclick="toggleFixMatrix(10)"><canvas id="previewCanvas10" width="50" height="50"></canvas><br>Head 10</div><div class="button" id="button11" onmouseover="showMatrix(11, true)" onclick="toggleFixMatrix(11)"><canvas id="previewCanvas11" width="50" height="50"></canvas><br>Head 11</div><div class="button" id="button12" onmouseover="showMatrix(12, true)" onclick="toggleFixMatrix(12)"><canvas id="previewCanvas12" width="50" height="50"></canvas><br>Head 12</div><div class="button" id="button13" onmouseover="showMatrix(13, true)" onclick="toggleFixMatrix(13)"><canvas id="previewCanvas13" width="50" height="50"></canvas><br>Head 13</div><div class="button" id="button14" onmouseover="showMatrix(14, true)" onclick="toggleFixMatrix(14)"><canvas id="previewCanvas14" width="50" height="50"></canvas><br>Head 14</div><div class="button" id="button15" onmouseover="showMatrix(15, true)" onclick="toggleFixMatrix(15)"><canvas id="previewCanvas15" width="50" height="50"></canvas><br>Head 15</div><div class="button" id="button16" onmouseover="showMatrix(16, true)" onclick="toggleFixMatrix(16)"><canvas id="previewCanvas16" width="50" height="50"></canvas><br>Head 16</div><div class="button" id="button17" onmouseover="showMatrix(17, true)" onclick="toggleFixMatrix(17)"><canvas id="previewCanvas17" width="50" height="50"></canvas><br>Head 17</div><div class="button" id="button18" onmouseover="showMatrix(18, true)" onclick="toggleFixMatrix(18)"><canvas id="previewCanvas18" width="50" height="50"></canvas><br>Head 18</div><div class="button" id="button19" onmouseover="showMatrix(19, true)" onclick="toggleFixMatrix(19)"><canvas id="previewCanvas19" width="50" height="50"></canvas><br>Head 19</div>
</div>
<div class="viewer">
    <div class="canvas-wrapper">
        <canvas id="heatmapCanvas"></canvas>
        <div class="legend">
            <canvas id="legendCanvas" width="200" height="20"></canvas>
        </div>
    </div>
    <div class="token-viewer">
        <div class="mode-buttons">
            <div class="mode-button active" id="rowMode" onclick="setMode('row')">Row Mode</div>
            <div class="mode-button" id="columnMode" onclick="setMode('column')">Column Mode</div>
        </div>
        <div id="tokens">
            <span class="token" id="token0" onmouseover="highlightRowOrColumnAndToken(0)" onclick="toggleFixRowOrColumn(0)">&lt;|endoftext|&gt;</span><span class="token" id="token1" onmouseover="highlightRowOrColumnAndToken(1)" onclick="toggleFixRowOrColumn(1)">def</span><span class="token" id="token2" onmouseover="highlightRowOrColumnAndToken(2)" onclick="toggleFixRowOrColumn(2)">&nbsp;main</span><span class="token" id="token3" onmouseover="highlightRowOrColumnAndToken(3)" onclick="toggleFixRowOrColumn(3)">():</span><span class="token" id="token4" onmouseover="highlightRowOrColumnAndToken(4)" onclick="toggleFixRowOrColumn(4)">www</span>
        </div>
    </div>
</div>
<script>
    const canvas = document.getElementById('heatmapCanvas');
    const ctx = canvas.getContext('2d');
    const matrices = [[[1.0, 0.0, 0.0, 0.0, 0.0], [0.898485004901886, 0.10151498019695282, 0.0, 0.0, 0.0], [0.17970313131809235, 0.7375934720039368, 0.08270340412855148, 0.0, 0.0], [0.49592462182044983, 0.2849602997303009, 0.03408928960561752, 0.18502575159072876, 0.0], [0.2491011917591095, 0.2501743733882904, 0.19346342980861664, 0.20818711817264557, 0.09907388687133789]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.7615202069282532, 0.23847977817058563, 0.0, 0.0, 0.0], [0.199533611536026, 0.6604580283164978, 0.140008345246315, 0.0, 0.0], [0.316011905670166, 0.29383182525634766, 0.05535127595067024, 0.3348049819469452, 0.0], [0.0654284805059433, 0.11028576642274857, 0.024836638942360878, 0.7591313123703003, 0.04031785950064659]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.3483876883983612, 0.6516123414039612, 0.0, 0.0, 0.0], [0.5009260773658752, 0.03135673329234123, 0.46771717071533203, 0.0, 0.0], [0.42606282234191895, 0.10146663337945938, 0.09426803141832352, 0.37820249795913696, 0.0], [0.2527965009212494, 0.07794920355081558, 0.13719940185546875, 0.10335248708724976, 0.42870238423347473]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8964508175849915, 0.10354919731616974, 0.0, 0.0, 0.0], [0.5827227234840393, 0.1715284287929535, 0.2457488775253296, 0.0, 0.0], [0.25257638096809387, 0.1166980192065239, 0.5829378962516785, 0.047787655144929886, 0.0], [0.2848482131958008, 0.08205262571573257, 0.05299174040555954, 0.4636300802230835, 0.1164773553609848]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.7337700724601746, 0.2662300169467926, 0.0, 0.0, 0.0], [0.15240263938903809, 0.546881914138794, 0.30071547627449036, 0.0, 0.0], [0.1156320795416832, 0.49402686953544617, 0.3328319191932678, 0.057509105652570724, 0.0], [0.10575052350759506, 0.42945200204849243, 0.23792217671871185, 0.1280774176120758, 0.09879787266254425]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8506700396537781, 0.1493300050497055, 0.0, 0.0, 0.0], [0.7468333840370178, 0.18533563613891602, 0.06783099472522736, 0.0, 0.0], [0.29555436968803406, 0.053380973637104034, 0.01688752882182598, 0.6341770887374878, 0.0], [0.14584477245807648, 0.07403776794672012, 0.007071464788168669, 0.724596381187439, 0.04844965413212776]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.17847009003162384, 0.8215299248695374, 0.0, 0.0, 0.0], [0.49079665541648865, 0.08488103747367859, 0.42432230710983276, 0.0, 0.0], [0.007952422834932804, 0.24566228687763214, 0.06013500317931175, 0.6862503290176392, 0.0], [0.9805270433425903, 0.008306227624416351, 0.007383448537439108, 0.0001017276372294873, 0.0036815092898905277]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.7889653444290161, 0.21103468537330627, 0.0, 0.0, 0.0], [0.49455592036247253, 0.41373971104621887, 0.09170438349246979, 0.0, 0.0], [0.15915614366531372, 0.3688508868217468, 0.4189753532409668, 0.053017616271972656, 0.0], [0.21252913773059845, 0.0605403333902359, 0.1526469886302948, 0.04214930906891823, 0.5321341753005981]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.015290607698261738, 0.9847093820571899, 0.0, 0.0, 0.0], [0.026758607476949692, 0.0016431509284302592, 0.971598207950592, 0.0, 0.0], [0.09218089282512665, 0.005726253148168325, 0.00017459309310652316, 0.9019182920455933, 0.0], [0.12747012078762054, 0.0017748455284163356, 0.00396414939314127, 0.007147755473852158, 0.8596431612968445]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.5037027597427368, 0.4962972104549408, 0.0, 0.0, 0.0], [0.25727877020835876, 0.460074782371521, 0.2826464772224426, 0.0, 0.0], [0.220728799700737, 0.365597128868103, 0.2462218701839447, 0.16745223104953766, 0.0], [0.1771952211856842, 0.33276280760765076, 0.1724904179573059, 0.20952336490154266, 0.10802819579839706]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.6912838220596313, 0.30871614813804626, 0.0, 0.0, 0.0], [0.46782180666923523, 0.15780189633369446, 0.3743763267993927, 0.0, 0.0], [0.3542255461215973, 0.12366732954978943, 0.45686525106430054, 0.06524188071489334, 0.0], [0.42535144090652466, 0.05506027862429619, 0.25765371322631836, 0.08807539939880371, 0.173859104514122]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.6193392276763916, 0.3806607723236084, 0.0, 0.0, 0.0], [0.4993880093097687, 0.2952345907688141, 0.20537742972373962, 0.0, 0.0], [0.44145503640174866, 0.21275685727596283, 0.1520387977361679, 0.1937493532896042, 0.0], [0.2897590398788452, 0.15750651061534882, 0.11210404336452484, 0.2179160863161087, 0.2227144092321396]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.24008570611476898, 0.7599142789840698, 0.0, 0.0, 0.0], [0.13375838100910187, 0.14182662963867188, 0.7244149446487427, 0.0, 0.0], [0.25098568201065063, 0.18414486944675446, 0.143332839012146, 0.4215366244316101, 0.0], [0.19724570214748383, 0.04589861258864403, 0.2512255609035492, 0.020794084295630455, 0.48483601212501526]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9370339512825012, 0.06296607106924057, 0.0, 0.0, 0.0], [0.8138469457626343, 0.08927479386329651, 0.09687831252813339, 0.0, 0.0], [0.591547966003418, 0.0268756952136755, 0.11013392359018326, 0.2714424133300781, 0.0], [0.706113874912262, 0.06337859481573105, 0.15935534238815308, 0.06050685793161392, 0.010645323432981968]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.7396194934844971, 0.26038050651550293, 0.0, 0.0, 0.0], [0.3648747205734253, 0.3296165466308594, 0.30550867319107056, 0.0, 0.0], [0.31582996249198914, 0.2992608845233917, 0.30175331234931946, 0.0831557884812355, 0.0], [0.21438533067703247, 0.25934043526649475, 0.24829478561878204, 0.09459805488586426, 0.1833813637495041]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9434781074523926, 0.0565219409763813, 0.0, 0.0, 0.0], [0.8171221613883972, 0.03775179386138916, 0.14512601494789124, 0.0, 0.0], [0.48346152901649475, 0.06646853685379028, 0.24836961925029755, 0.20170028507709503, 0.0], [0.33866605162620544, 0.045424070209264755, 0.12794427573680878, 0.20039476454257965, 0.2875707447528839]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.930223822593689, 0.06977624446153641, 0.0, 0.0, 0.0], [0.29729902744293213, 0.6283715963363647, 0.07432934641838074, 0.0, 0.0], [0.16069646179676056, 0.3622925281524658, 0.1417495161294937, 0.3352615237236023, 0.0], [0.16875909268856049, 0.07503502070903778, 0.134337916970253, 0.21999070048332214, 0.4018772542476654]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9073619246482849, 0.09263808280229568, 0.0, 0.0, 0.0], [0.6288400292396545, 0.2666882574558258, 0.10447168350219727, 0.0, 0.0], [0.5578675270080566, 0.24490730464458466, 0.09313972294330597, 0.10408546030521393, 0.0], [0.37226563692092896, 0.13304850459098816, 0.11776857823133469, 0.2832775115966797, 0.09363972395658493]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9327284097671509, 0.06727157533168793, 0.0, 0.0, 0.0], [0.5702005624771118, 0.1416792869567871, 0.28812018036842346, 0.0, 0.0], [0.4270436763763428, 0.2574462592601776, 0.1634284257888794, 0.15208160877227783, 0.0], [0.2900743782520294, 0.017406096681952477, 0.09910828620195389, 0.19042536616325378, 0.40298575162887573]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.7133619785308838, 0.2866380214691162, 0.0, 0.0, 0.0], [0.37831300497055054, 0.27703574299812317, 0.3446512520313263, 0.0, 0.0], [0.4229353070259094, 0.224381223320961, 0.24277156591415405, 0.10991188138723373, 0.0], [0.4161645472049713, 0.1379258930683136, 0.184174582362175, 0.08442287147045135, 0.17731215059757233]]];
    const rows = 5;
    const cols = 5;
    const minVals = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0];
    const maxVals = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];
    const hues = [276, 24, 227, 306, 35, 196, 88, 200, 87, 234, 207, 321, 353, 10, 341, 125, 102, 8, 185, 212];
    let fixedMatrixIndex = null;
    let currentMatrixIndex = 0;
    let currentMode = 'row'; // Default mode
    const legendCanvas = document.getElementById('legendCanvas');
    const legendCtx = legendCanvas.getContext('2d');

    function resizeCanvas() {
        const canvasWrapper = document.querySelector('.canvas-wrapper');
        canvas.width = canvasWrapper.clientWidth;
        canvas.height = canvasWrapper.clientHeight;
        drawMatrix(currentMatrixIndex);
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function valueToColor(value, minVal, maxVal, hue, dim = false) {
        const normalizedValue = (value - minVal) / (maxVal - minVal);
        const lightness = 100 - Math.floor(normalizedValue * 75);  // lightness from 25% to 100%
        if (dim) {
            return `hsl(${hue}, 0%, ${lightness}%)`;  // Dim the brightness for non-highlighted rows
        }
        return `hsl(${hue}, 100%, ${lightness}%)`;
    }

    function drawMatrix(matrixIndex, highlightIndex = null) {
        const data = matrices[matrixIndex];
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        const currentRows = data.length;
        const currentCols = data[0].length;
        const cellWidth = Math.floor(canvas.width / currentCols);
        const cellHeight = Math.floor(canvas.height / currentRows);

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        for (let i = 0; i < currentRows; i++) {
            for (let j = 0; j < currentCols; j++) {
                let dim = false;
                if (highlightIndex !== null) {
                    if (currentMode === 'row' && i !== highlightIndex) {
                        dim = true;
                    } else if (currentMode === 'column' && j !== highlightIndex) {
                        dim = true;
                    }
                }
                ctx.fillStyle = valueToColor(data[i][j], minVal, maxVal, hue, dim);
                ctx.fillRect(j * cellWidth, i * cellHeight, cellWidth, cellHeight);
            }
        }
    }

    function showMatrix(matrixIndex, updateTokens = false) {
        currentMatrixIndex = matrixIndex;
        if (fixedMatrixIndex === null) {
            drawMatrix(matrixIndex);
        }
        if (updateTokens) {
            const rowOrColumn = matrices[matrixIndex][0];
            const minVal = minVals[matrixIndex];
            const maxVal = maxVals[matrixIndex];
            const hue = hues[matrixIndex];
            for (let i = 0; i < rowOrColumn.length; i++) {
                const tokenElem = document.getElementById('token' + i);
                tokenElem.style.backgroundColor = valueToColor(rowOrColumn[i], minVal, maxVal, hue);
            }
        }
        updateLegend();
    }
    
    function drawLegend(minVal, maxVal, hue) {
        const gradient = legendCtx.createLinearGradient(0, 0, legendCanvas.width, 0);
        for (let i = 0; i <= 100; i++) {
            const value = minVal + (i / 100) * (maxVal - minVal);
            const color = valueToColor(value, minVal, maxVal, hue);
            gradient.addColorStop(i / 100, color);
        }

        legendCtx.fillStyle = gradient;
        legendCtx.fillRect(0, 0, legendCanvas.width, legendCanvas.height);

        // Add text labels for min and max values
        legendCtx.fillStyle = 'black';
        legendCtx.font = '14px Arial';
        legendCtx.fontWeight = 'bold';
        legendCtx.fillText(minVal.toFixed(2), 0, legendCanvas.height - 3);
        legendCtx.fillText(maxVal.toFixed(2), legendCanvas.width - 30, legendCanvas.height - 3);
    }

    function updateLegend() {
        const minVal = minVals[currentMatrixIndex];
        const maxVal = maxVals[currentMatrixIndex];
        const hue = hues[currentMatrixIndex];
        drawLegend(minVal, maxVal, hue);
    }

    function toggleFixMatrix(matrixIndex) {
        if (fixedMatrixIndex === matrixIndex) {
            fixedMatrixIndex = null;
            document.getElementById('button' + matrixIndex).classList.remove('neon');
        } else {
            fixedMatrixIndex = matrixIndex;
            // Remove neon effect from all buttons
            for (let i = 0; i < matrices.length; i++) {
                document.getElementById('button' + i).classList.remove('neon');
            }
            // Add neon effect to the selected button
            document.getElementById('button' + matrixIndex).classList.add('neon');
        }
        drawMatrix(matrixIndex);
    }

    function highlightRowOrColumnAndToken(index) {
        if (currentMode === 'row') {
            highlightRow(index);
        } else {
            highlightColumn(index);
        }
        highlightToken(index);
    }

    function highlightRow(rowIndex) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        drawMatrix(matrixIndex, rowIndex);
    }

    function highlightColumn(colIndex) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        drawMatrix(matrixIndex, colIndex);
    }

    function highlightToken(index) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        let values;
        if (currentMode === 'row') {
            values = matrices[matrixIndex][index];
        } else {
            values = matrices[matrixIndex].map(row => row[index]);
        }
        for (let i = 0; i < values.length; i++) {
            const tokenElem = document.getElementById('token' + i);
            tokenElem.style.backgroundColor = valueToColor(values[i], minVal, maxVal, hue);
        }
    }

    function toggleFixRowOrColumn(index) {
        if (fixedMatrixIndex !== null) {
            if (currentMode === 'row') {
                highlightRow(index);
            } else {
                highlightColumn(index);
            }
        }
    }

    function drawPreview(matrixIndex) {
        const previewCanvas = document.getElementById('previewCanvas' + matrixIndex);
        const previewCtx = previewCanvas.getContext('2d');
        const data = matrices[matrixIndex];
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        const previewRows = previewCanvas.height;
        const previewCols = previewCanvas.width;
        const cellHeight = Math.max(previewCanvas.height / data.length, 2);
        const cellWidth = Math.max(previewCanvas.width / data[0].length, 2);
        const maxIndex = Math.min(previewRows / cellWidth, data.length);
        console.log(cellWidth, cellHeight, maxIndex)
        for (let i = 0; i < maxIndex; i++) {
            for (let j = 0; j < maxIndex; j++) {
                previewCtx.fillStyle = valueToColor(data[i][j], minVal, maxVal, hue);
                previewCtx.fillRect(j * cellWidth, i * cellHeight, cellWidth, cellHeight);
            }
        }
    }

    function setMode(mode) {
        currentMode = mode;
        document.getElementById('rowMode').classList.toggle('active', mode === 'row');
        document.getElementById('columnMode').classList.toggle('active', mode === 'column');
        // Redraw the matrix to update the neon effect
        drawMatrix(currentMatrixIndex);
        updateLegend();
    }

    // Draw previews
    for (let i = 0; i < matrices.length; i++) {
        drawPreview(i);
    }

    // Initial display
    showMatrix(currentMatrixIndex);
</script>
</body>
</html>
    