
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Matrix Heatmap</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        .viewer {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }
        #buttons {
            margin-bottom: 10px;
        }
        .button {
            display: inline-block;
            margin-right: 5px;
            cursor: pointer;
            text-align: center;
        }
        .button {
            border: 1px solid black;
        }
        .button.neon {
            box-shadow: 0 0 10px #00f, 0 0 20px #00f, 0 0 30px #00f, 0 0 40px #00f;
        }
        .token {
            display: inline-block;
            cursor: pointer;
            margin: 2px 0;
            padding: 2px 5px;
        }
        .token:hover {
            text-decoration: underline;
        }
        #tokens {
            margin-left: 20px;
            word-wrap: break-word;
            font-size: 30px;
        }
        .canvas-wrapper {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: min(75vw, 75vh);
            height: min(75vw, 75vh);
        }
        canvas {
            width: 100%;
            height: 100%;
        }
        .token-viewer {
            display: flex;
            flex-direction: column;
            justify-content: top;
            align-items: center;
            height: 75vh;
            overflow-y: auto;
        }
        .mode-buttons {
            margin-bottom: 10px;
        }
        .mode-button {
            cursor: pointer;
            padding: 5px 10px;
            margin-right: 5px;
            border: 1px solid black;
            border-radius: 3px;
        }
        .mode-button.active {
            background-color: #00f;
            color: #fff;
        }
        .legend {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
        }

        .legend canvas {
            border: 1px solid black;
        }

    </style>
</head>
<body>
<div id="buttons">
    <div class="button" id="button0" onmouseover="showMatrix(0, true)" onclick="toggleFixMatrix(0)"><canvas id="previewCanvas0" width="50" height="50"></canvas><br>Head 0</div><div class="button" id="button1" onmouseover="showMatrix(1, true)" onclick="toggleFixMatrix(1)"><canvas id="previewCanvas1" width="50" height="50"></canvas><br>Head 1</div><div class="button" id="button2" onmouseover="showMatrix(2, true)" onclick="toggleFixMatrix(2)"><canvas id="previewCanvas2" width="50" height="50"></canvas><br>Head 2</div><div class="button" id="button3" onmouseover="showMatrix(3, true)" onclick="toggleFixMatrix(3)"><canvas id="previewCanvas3" width="50" height="50"></canvas><br>Head 3</div><div class="button" id="button4" onmouseover="showMatrix(4, true)" onclick="toggleFixMatrix(4)"><canvas id="previewCanvas4" width="50" height="50"></canvas><br>Head 4</div><div class="button" id="button5" onmouseover="showMatrix(5, true)" onclick="toggleFixMatrix(5)"><canvas id="previewCanvas5" width="50" height="50"></canvas><br>Head 5</div><div class="button" id="button6" onmouseover="showMatrix(6, true)" onclick="toggleFixMatrix(6)"><canvas id="previewCanvas6" width="50" height="50"></canvas><br>Head 6</div><div class="button" id="button7" onmouseover="showMatrix(7, true)" onclick="toggleFixMatrix(7)"><canvas id="previewCanvas7" width="50" height="50"></canvas><br>Head 7</div><div class="button" id="button8" onmouseover="showMatrix(8, true)" onclick="toggleFixMatrix(8)"><canvas id="previewCanvas8" width="50" height="50"></canvas><br>Head 8</div><div class="button" id="button9" onmouseover="showMatrix(9, true)" onclick="toggleFixMatrix(9)"><canvas id="previewCanvas9" width="50" height="50"></canvas><br>Head 9</div><div class="button" id="button10" onmouseover="showMatrix(10, true)" onclick="toggleFixMatrix(10)"><canvas id="previewCanvas10" width="50" height="50"></canvas><br>Head 10</div><div class="button" id="button11" onmouseover="showMatrix(11, true)" onclick="toggleFixMatrix(11)"><canvas id="previewCanvas11" width="50" height="50"></canvas><br>Head 11</div><div class="button" id="button12" onmouseover="showMatrix(12, true)" onclick="toggleFixMatrix(12)"><canvas id="previewCanvas12" width="50" height="50"></canvas><br>Head 12</div><div class="button" id="button13" onmouseover="showMatrix(13, true)" onclick="toggleFixMatrix(13)"><canvas id="previewCanvas13" width="50" height="50"></canvas><br>Head 13</div><div class="button" id="button14" onmouseover="showMatrix(14, true)" onclick="toggleFixMatrix(14)"><canvas id="previewCanvas14" width="50" height="50"></canvas><br>Head 14</div><div class="button" id="button15" onmouseover="showMatrix(15, true)" onclick="toggleFixMatrix(15)"><canvas id="previewCanvas15" width="50" height="50"></canvas><br>Head 15</div><div class="button" id="button16" onmouseover="showMatrix(16, true)" onclick="toggleFixMatrix(16)"><canvas id="previewCanvas16" width="50" height="50"></canvas><br>Head 16</div><div class="button" id="button17" onmouseover="showMatrix(17, true)" onclick="toggleFixMatrix(17)"><canvas id="previewCanvas17" width="50" height="50"></canvas><br>Head 17</div><div class="button" id="button18" onmouseover="showMatrix(18, true)" onclick="toggleFixMatrix(18)"><canvas id="previewCanvas18" width="50" height="50"></canvas><br>Head 18</div><div class="button" id="button19" onmouseover="showMatrix(19, true)" onclick="toggleFixMatrix(19)"><canvas id="previewCanvas19" width="50" height="50"></canvas><br>Head 19</div>
</div>
<div class="viewer">
    <div class="canvas-wrapper">
        <canvas id="heatmapCanvas"></canvas>
        <div class="legend">
            <canvas id="legendCanvas" width="200" height="20"></canvas>
        </div>
    </div>
    <div class="token-viewer">
        <div class="mode-buttons">
            <div class="mode-button active" id="rowMode" onclick="setMode('row')">Row Mode</div>
            <div class="mode-button" id="columnMode" onclick="setMode('column')">Column Mode</div>
        </div>
        <div id="tokens">
            <span class="token" id="token0" onmouseover="highlightRowOrColumnAndToken(0)" onclick="toggleFixRowOrColumn(0)">&lt;|endoftext|&gt;</span><span class="token" id="token1" onmouseover="highlightRowOrColumnAndToken(1)" onclick="toggleFixRowOrColumn(1)">def</span><span class="token" id="token2" onmouseover="highlightRowOrColumnAndToken(2)" onclick="toggleFixRowOrColumn(2)">&nbsp;main</span><span class="token" id="token3" onmouseover="highlightRowOrColumnAndToken(3)" onclick="toggleFixRowOrColumn(3)">():</span><span class="token" id="token4" onmouseover="highlightRowOrColumnAndToken(4)" onclick="toggleFixRowOrColumn(4)">www</span>
        </div>
    </div>
</div>
<script>
    const canvas = document.getElementById('heatmapCanvas');
    const ctx = canvas.getContext('2d');
    const matrices = [[[1.0, 0.0, 0.0, 0.0, 0.0], [0.9505854845046997, 0.04941451922059059, 0.0, 0.0, 0.0], [0.6687484979629517, 0.010448716580867767, 0.3208027780056, 0.0, 0.0], [0.9818864464759827, 0.009869069792330265, 0.0035677237901836634, 0.00467676343396306, 0.0], [0.8214018940925598, 0.020958691835403442, 0.027208657935261726, 0.01307988166809082, 0.11735089868307114]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.992793083190918, 0.007206896785646677, 0.0, 0.0, 0.0], [0.9973063468933105, 0.0021249388810247183, 0.0005688108503818512, 0.0, 0.0], [0.9807770848274231, 0.010529177263379097, 0.0033011985942721367, 0.005392579827457666, 0.0], [0.7467842698097229, 0.005283844657242298, 0.015563827008008957, 0.1421123892068863, 0.09025575965642929]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8597234487533569, 0.1402764767408371, 0.0, 0.0, 0.0], [0.9127181768417358, 0.04807214438915253, 0.03920967876911163, 0.0, 0.0], [0.5880351066589355, 0.06291133910417557, 0.07563326507806778, 0.2734202742576599, 0.0], [0.45608606934547424, 0.10278197377920151, 0.0837777704000473, 0.24758897721767426, 0.1097651943564415]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8927522897720337, 0.10724770277738571, 0.0, 0.0, 0.0], [0.7062957882881165, 0.18084697425365448, 0.11285720020532608, 0.0, 0.0], [0.4961044490337372, 0.23125220835208893, 0.1796182245016098, 0.09302513301372528, 0.0], [0.5503730177879333, 0.17930009961128235, 0.05559588223695755, 0.13776874542236328, 0.07696221023797989]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.95770663022995, 0.04229336977005005, 0.0, 0.0, 0.0], [0.9712000489234924, 0.024782150983810425, 0.0040178243070840836, 0.0, 0.0], [0.9319339394569397, 0.02684800513088703, 0.009860210120677948, 0.03135783225297928, 0.0], [0.879587709903717, 0.06391558051109314, 0.01694992370903492, 0.022645089775323868, 0.0169016495347023]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8221724033355713, 0.1778275966644287, 0.0, 0.0, 0.0], [0.5881357192993164, 0.26757675409317017, 0.14428754150867462, 0.0, 0.0], [0.6026968955993652, 0.19756509363651276, 0.11829095333814621, 0.08144702017307281, 0.0], [0.4385676980018616, 0.16307604312896729, 0.07406380027532578, 0.29260510206222534, 0.03168732672929764]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.49400660395622253, 0.5059934258460999, 0.0, 0.0, 0.0], [0.533943235874176, 0.16365332901477814, 0.3024034798145294, 0.0, 0.0], [0.4654557704925537, 0.25225114822387695, 0.23275603353977203, 0.049537014216184616, 0.0], [0.4831555485725403, 0.10488435626029968, 0.15404321253299713, 0.060304559767246246, 0.19761237502098083]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9379215836524963, 0.06207840517163277, 0.0, 0.0, 0.0], [0.8763986825942993, 0.11539257317781448, 0.00820868369191885, 0.0, 0.0], [0.8627558350563049, 0.04023082181811333, 0.003444785252213478, 0.09356850385665894, 0.0], [0.6264138221740723, 0.0713142603635788, 0.0352257676422596, 0.23767265677452087, 0.029373442754149437]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.3051287829875946, 0.6948712468147278, 0.0, 0.0, 0.0], [0.5320133566856384, 0.32902398705482483, 0.13896267116069794, 0.0, 0.0], [0.7215523719787598, 0.07912327349185944, 0.09580542147159576, 0.1035190150141716, 0.0], [0.4365237355232239, 0.13068687915802002, 0.23028124868869781, 0.08735625445842743, 0.11515189707279205]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.7511894106864929, 0.24881061911582947, 0.0, 0.0, 0.0], [0.14709210395812988, 0.7819647192955017, 0.07094316184520721, 0.0, 0.0], [0.7415676116943359, 0.12556900084018707, 0.08382348716259003, 0.0490398183465004, 0.0], [0.04405134916305542, 0.005670533049851656, 0.002367212437093258, 0.9382774829864502, 0.009633373469114304]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.6898528933525085, 0.31014710664749146, 0.0, 0.0, 0.0], [0.8524214625358582, 0.11888337135314941, 0.028695158660411835, 0.0, 0.0], [0.7080996036529541, 0.1541147381067276, 0.018427953124046326, 0.11935780197381973, 0.0], [0.36822327971458435, 0.17492850124835968, 0.10308385640382767, 0.27529817819595337, 0.07846617698669434]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9770825505256653, 0.02291746996343136, 0.0, 0.0, 0.0], [0.9922523498535156, 0.007513942662626505, 0.0002336881443625316, 0.0, 0.0], [0.9703913331031799, 0.014954631216824055, 0.0004971969756297767, 0.014156835153698921, 0.0], [0.7360348701477051, 0.0314350351691246, 0.002429976826533675, 0.19906079769134521, 0.031039254739880562]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9370481967926025, 0.06295178085565567, 0.0, 0.0, 0.0], [0.8174039125442505, 0.05138601362705231, 0.1312100887298584, 0.0, 0.0], [0.2712997496128082, 0.0756256952881813, 0.0752774253487587, 0.5777971148490906, 0.0], [0.42277443408966064, 0.03686613216996193, 0.014374002814292908, 0.247746080160141, 0.27823930978775024]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.5066994428634644, 0.49330055713653564, 0.0, 0.0, 0.0], [0.3091978132724762, 0.5153791308403015, 0.17542307078838348, 0.0, 0.0], [0.15230494737625122, 0.7037263512611389, 0.042029570788145065, 0.10193905979394913, 0.0], [0.65739905834198, 0.05176981911063194, 0.0247818510979414, 0.2191580981016159, 0.04689110815525055]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.815726101398468, 0.18427391350269318, 0.0, 0.0, 0.0], [0.9095654487609863, 0.06309583783149719, 0.027338722720742226, 0.0, 0.0], [0.5433796048164368, 0.1937790811061859, 0.14034797251224518, 0.12249328941106796, 0.0], [0.6296936273574829, 0.07488957792520523, 0.05029676482081413, 0.11276455968618393, 0.1323554664850235]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9964447617530823, 0.003555212402716279, 0.0, 0.0, 0.0], [0.8405379056930542, 0.09546477347612381, 0.06399735808372498, 0.0, 0.0], [0.5227767825126648, 0.25464141368865967, 0.043026503175497055, 0.17955535650253296, 0.0], [0.47974324226379395, 0.17176517844200134, 0.05246342346072197, 0.2686891257762909, 0.027339041233062744]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9803513884544373, 0.019648563116788864, 0.0, 0.0, 0.0], [0.986678421497345, 0.005721496883779764, 0.007600057870149612, 0.0, 0.0], [0.9567892551422119, 0.018625738099217415, 0.00766118336468935, 0.016923813149333, 0.0], [0.8413376808166504, 0.053153637796640396, 0.03475864231586456, 0.03547476977109909, 0.035275306552648544]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8855568170547485, 0.11444316804409027, 0.0, 0.0, 0.0], [0.6850937604904175, 0.10204840451478958, 0.21285782754421234, 0.0, 0.0], [0.6031472682952881, 0.21273182332515717, 0.07960382848978043, 0.10451704263687134, 0.0], [0.5217287540435791, 0.0961008220911026, 0.12525427341461182, 0.17417915165424347, 0.08273693919181824]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9426290988922119, 0.05737084150314331, 0.0, 0.0, 0.0], [0.8136979341506958, 0.12223610281944275, 0.06406600773334503, 0.0, 0.0], [0.536613941192627, 0.03160419687628746, 0.006968668662011623, 0.42481324076652527, 0.0], [0.28738850355148315, 0.2456057071685791, 0.00547294644638896, 0.3186130225658417, 0.14291983842849731]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8779131770133972, 0.12208683043718338, 0.0, 0.0, 0.0], [0.8953433632850647, 0.02265601046383381, 0.08200057595968246, 0.0, 0.0], [0.8701627254486084, 0.04963747784495354, 0.054903578013181686, 0.02529621496796608, 0.0], [0.8696528077125549, 0.01201850175857544, 0.015890048816800117, 0.013412082567811012, 0.08902651071548462]]];
    const rows = 5;
    const cols = 5;
    const minVals = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0];
    const maxVals = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];
    const hues = [345, 337, 359, 197, 23, 222, 137, 293, 86, 3, 40, 126, 158, 138, 37, 161, 89, 91, 53, 228];
    let fixedMatrixIndex = null;
    let currentMatrixIndex = 0;
    let currentMode = 'row'; // Default mode
    const legendCanvas = document.getElementById('legendCanvas');
    const legendCtx = legendCanvas.getContext('2d');

    function resizeCanvas() {
        const canvasWrapper = document.querySelector('.canvas-wrapper');
        canvas.width = canvasWrapper.clientWidth;
        canvas.height = canvasWrapper.clientHeight;
        drawMatrix(currentMatrixIndex);
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function valueToColor(value, minVal, maxVal, hue, dim = false) {
        const normalizedValue = (value - minVal) / (maxVal - minVal);
        const lightness = 100 - Math.floor(normalizedValue * 75);  // lightness from 25% to 100%
        if (dim) {
            return `hsl(${hue}, 0%, ${lightness}%)`;  // Dim the brightness for non-highlighted rows
        }
        return `hsl(${hue}, 100%, ${lightness}%)`;
    }

    function drawMatrix(matrixIndex, highlightIndex = null) {
        const data = matrices[matrixIndex];
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        const currentRows = data.length;
        const currentCols = data[0].length;
        const cellWidth = Math.floor(canvas.width / currentCols);
        const cellHeight = Math.floor(canvas.height / currentRows);

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        for (let i = 0; i < currentRows; i++) {
            for (let j = 0; j < currentCols; j++) {
                let dim = false;
                if (highlightIndex !== null) {
                    if (currentMode === 'row' && i !== highlightIndex) {
                        dim = true;
                    } else if (currentMode === 'column' && j !== highlightIndex) {
                        dim = true;
                    }
                }
                ctx.fillStyle = valueToColor(data[i][j], minVal, maxVal, hue, dim);
                ctx.fillRect(j * cellWidth, i * cellHeight, cellWidth, cellHeight);
            }
        }
    }

    function showMatrix(matrixIndex, updateTokens = false) {
        currentMatrixIndex = matrixIndex;
        if (fixedMatrixIndex === null) {
            drawMatrix(matrixIndex);
        }
        if (updateTokens) {
            const rowOrColumn = matrices[matrixIndex][0];
            const minVal = minVals[matrixIndex];
            const maxVal = maxVals[matrixIndex];
            const hue = hues[matrixIndex];
            for (let i = 0; i < rowOrColumn.length; i++) {
                const tokenElem = document.getElementById('token' + i);
                tokenElem.style.backgroundColor = valueToColor(rowOrColumn[i], minVal, maxVal, hue);
            }
        }
        updateLegend();
    }
    
    function drawLegend(minVal, maxVal, hue) {
        const gradient = legendCtx.createLinearGradient(0, 0, legendCanvas.width, 0);
        for (let i = 0; i <= 100; i++) {
            const value = minVal + (i / 100) * (maxVal - minVal);
            const color = valueToColor(value, minVal, maxVal, hue);
            gradient.addColorStop(i / 100, color);
        }

        legendCtx.fillStyle = gradient;
        legendCtx.fillRect(0, 0, legendCanvas.width, legendCanvas.height);

        // Add text labels for min and max values
        legendCtx.fillStyle = 'black';
        legendCtx.font = '14px Arial';
        legendCtx.fontWeight = 'bold';
        legendCtx.fillText(minVal.toFixed(2), 0, legendCanvas.height - 3);
        legendCtx.fillText(maxVal.toFixed(2), legendCanvas.width - 30, legendCanvas.height - 3);
    }

    function updateLegend() {
        const minVal = minVals[currentMatrixIndex];
        const maxVal = maxVals[currentMatrixIndex];
        const hue = hues[currentMatrixIndex];
        drawLegend(minVal, maxVal, hue);
    }

    function toggleFixMatrix(matrixIndex) {
        if (fixedMatrixIndex === matrixIndex) {
            fixedMatrixIndex = null;
            document.getElementById('button' + matrixIndex).classList.remove('neon');
        } else {
            fixedMatrixIndex = matrixIndex;
            // Remove neon effect from all buttons
            for (let i = 0; i < matrices.length; i++) {
                document.getElementById('button' + i).classList.remove('neon');
            }
            // Add neon effect to the selected button
            document.getElementById('button' + matrixIndex).classList.add('neon');
        }
        drawMatrix(matrixIndex);
    }

    function highlightRowOrColumnAndToken(index) {
        if (currentMode === 'row') {
            highlightRow(index);
        } else {
            highlightColumn(index);
        }
        highlightToken(index);
    }

    function highlightRow(rowIndex) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        drawMatrix(matrixIndex, rowIndex);
    }

    function highlightColumn(colIndex) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        drawMatrix(matrixIndex, colIndex);
    }

    function highlightToken(index) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        let values;
        if (currentMode === 'row') {
            values = matrices[matrixIndex][index];
        } else {
            values = matrices[matrixIndex].map(row => row[index]);
        }
        for (let i = 0; i < values.length; i++) {
            const tokenElem = document.getElementById('token' + i);
            tokenElem.style.backgroundColor = valueToColor(values[i], minVal, maxVal, hue);
        }
    }

    function toggleFixRowOrColumn(index) {
        if (fixedMatrixIndex !== null) {
            if (currentMode === 'row') {
                highlightRow(index);
            } else {
                highlightColumn(index);
            }
        }
    }

    function drawPreview(matrixIndex) {
        const previewCanvas = document.getElementById('previewCanvas' + matrixIndex);
        const previewCtx = previewCanvas.getContext('2d');
        const data = matrices[matrixIndex];
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        const previewRows = previewCanvas.height;
        const previewCols = previewCanvas.width;
        const cellHeight = Math.max(previewCanvas.height / data.length, 2);
        const cellWidth = Math.max(previewCanvas.width / data[0].length, 2);
        const maxIndex = Math.min(previewRows / cellWidth, data.length);
        console.log(cellWidth, cellHeight, maxIndex)
        for (let i = 0; i < maxIndex; i++) {
            for (let j = 0; j < maxIndex; j++) {
                previewCtx.fillStyle = valueToColor(data[i][j], minVal, maxVal, hue);
                previewCtx.fillRect(j * cellWidth, i * cellHeight, cellWidth, cellHeight);
            }
        }
    }

    function setMode(mode) {
        currentMode = mode;
        document.getElementById('rowMode').classList.toggle('active', mode === 'row');
        document.getElementById('columnMode').classList.toggle('active', mode === 'column');
        // Redraw the matrix to update the neon effect
        drawMatrix(currentMatrixIndex);
        updateLegend();
    }

    // Draw previews
    for (let i = 0; i < matrices.length; i++) {
        drawPreview(i);
    }

    // Initial display
    showMatrix(currentMatrixIndex);
</script>
</body>
</html>
    