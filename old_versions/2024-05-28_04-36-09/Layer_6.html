
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Matrix Heatmap</title>
    <style>
        body {
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
        }
        .viewer {
            display: flex;
            flex-direction: row;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 100%;
        }
        #buttons {
            margin-bottom: 10px;
        }
        .button {
            display: inline-block;
            margin-right: 5px;
            cursor: pointer;
            text-align: center;
        }
        .button {
            border: 1px solid black;
        }
        .button.neon {
            box-shadow: 0 0 10px #00f, 0 0 20px #00f, 0 0 30px #00f, 0 0 40px #00f;
        }
        .token {
            display: inline-block;
            cursor: pointer;
            margin: 2px 0;
            padding: 2px 5px;
        }
        .token:hover {
            text-decoration: underline;
        }
        #tokens {
            margin-left: 20px;
            word-wrap: break-word;
            font-size: 30px;
        }
        .canvas-wrapper {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            width: min(75vw, 75vh);
            height: min(75vw, 75vh);
        }
        canvas {
            width: 100%;
            height: 100%;
        }
        .token-viewer {
            display: flex;
            flex-direction: column;
            justify-content: top;
            align-items: center;
            height: 75vh;
            overflow-y: auto;
        }
        .mode-buttons {
            margin-bottom: 10px;
        }
        .mode-button {
            cursor: pointer;
            padding: 5px 10px;
            margin-right: 5px;
            border: 1px solid black;
            border-radius: 3px;
        }
        .mode-button.active {
            background-color: #00f;
            color: #fff;
        }
        .legend {
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 10px;
        }

        .legend canvas {
            border: 1px solid black;
        }

    </style>
</head>
<body>
<div id="buttons">
    <div class="button" id="button0" onmouseover="showMatrix(0, true)" onclick="toggleFixMatrix(0)"><canvas id="previewCanvas0" width="50" height="50"></canvas><br>Head 0</div><div class="button" id="button1" onmouseover="showMatrix(1, true)" onclick="toggleFixMatrix(1)"><canvas id="previewCanvas1" width="50" height="50"></canvas><br>Head 1</div><div class="button" id="button2" onmouseover="showMatrix(2, true)" onclick="toggleFixMatrix(2)"><canvas id="previewCanvas2" width="50" height="50"></canvas><br>Head 2</div><div class="button" id="button3" onmouseover="showMatrix(3, true)" onclick="toggleFixMatrix(3)"><canvas id="previewCanvas3" width="50" height="50"></canvas><br>Head 3</div><div class="button" id="button4" onmouseover="showMatrix(4, true)" onclick="toggleFixMatrix(4)"><canvas id="previewCanvas4" width="50" height="50"></canvas><br>Head 4</div><div class="button" id="button5" onmouseover="showMatrix(5, true)" onclick="toggleFixMatrix(5)"><canvas id="previewCanvas5" width="50" height="50"></canvas><br>Head 5</div><div class="button" id="button6" onmouseover="showMatrix(6, true)" onclick="toggleFixMatrix(6)"><canvas id="previewCanvas6" width="50" height="50"></canvas><br>Head 6</div><div class="button" id="button7" onmouseover="showMatrix(7, true)" onclick="toggleFixMatrix(7)"><canvas id="previewCanvas7" width="50" height="50"></canvas><br>Head 7</div><div class="button" id="button8" onmouseover="showMatrix(8, true)" onclick="toggleFixMatrix(8)"><canvas id="previewCanvas8" width="50" height="50"></canvas><br>Head 8</div><div class="button" id="button9" onmouseover="showMatrix(9, true)" onclick="toggleFixMatrix(9)"><canvas id="previewCanvas9" width="50" height="50"></canvas><br>Head 9</div><div class="button" id="button10" onmouseover="showMatrix(10, true)" onclick="toggleFixMatrix(10)"><canvas id="previewCanvas10" width="50" height="50"></canvas><br>Head 10</div><div class="button" id="button11" onmouseover="showMatrix(11, true)" onclick="toggleFixMatrix(11)"><canvas id="previewCanvas11" width="50" height="50"></canvas><br>Head 11</div><div class="button" id="button12" onmouseover="showMatrix(12, true)" onclick="toggleFixMatrix(12)"><canvas id="previewCanvas12" width="50" height="50"></canvas><br>Head 12</div><div class="button" id="button13" onmouseover="showMatrix(13, true)" onclick="toggleFixMatrix(13)"><canvas id="previewCanvas13" width="50" height="50"></canvas><br>Head 13</div><div class="button" id="button14" onmouseover="showMatrix(14, true)" onclick="toggleFixMatrix(14)"><canvas id="previewCanvas14" width="50" height="50"></canvas><br>Head 14</div><div class="button" id="button15" onmouseover="showMatrix(15, true)" onclick="toggleFixMatrix(15)"><canvas id="previewCanvas15" width="50" height="50"></canvas><br>Head 15</div><div class="button" id="button16" onmouseover="showMatrix(16, true)" onclick="toggleFixMatrix(16)"><canvas id="previewCanvas16" width="50" height="50"></canvas><br>Head 16</div><div class="button" id="button17" onmouseover="showMatrix(17, true)" onclick="toggleFixMatrix(17)"><canvas id="previewCanvas17" width="50" height="50"></canvas><br>Head 17</div><div class="button" id="button18" onmouseover="showMatrix(18, true)" onclick="toggleFixMatrix(18)"><canvas id="previewCanvas18" width="50" height="50"></canvas><br>Head 18</div><div class="button" id="button19" onmouseover="showMatrix(19, true)" onclick="toggleFixMatrix(19)"><canvas id="previewCanvas19" width="50" height="50"></canvas><br>Head 19</div>
</div>
<div class="viewer">
    <div class="canvas-wrapper">
        <canvas id="heatmapCanvas"></canvas>
        <div class="legend">
            <canvas id="legendCanvas" width="200" height="20"></canvas>
        </div>
    </div>
    <div class="token-viewer">
        <div class="mode-buttons">
            <div class="mode-button active" id="rowMode" onclick="setMode('row')">Row Mode</div>
            <div class="mode-button" id="columnMode" onclick="setMode('column')">Column Mode</div>
        </div>
        <div id="tokens">
            <span class="token" id="token0" onmouseover="highlightRowOrColumnAndToken(0)" onclick="toggleFixRowOrColumn(0)">&lt;|endoftext|&gt;</span><span class="token" id="token1" onmouseover="highlightRowOrColumnAndToken(1)" onclick="toggleFixRowOrColumn(1)">def</span><span class="token" id="token2" onmouseover="highlightRowOrColumnAndToken(2)" onclick="toggleFixRowOrColumn(2)">&nbsp;main</span><span class="token" id="token3" onmouseover="highlightRowOrColumnAndToken(3)" onclick="toggleFixRowOrColumn(3)">():</span><span class="token" id="token4" onmouseover="highlightRowOrColumnAndToken(4)" onclick="toggleFixRowOrColumn(4)">www</span>
        </div>
    </div>
</div>
<script>
    const canvas = document.getElementById('heatmapCanvas');
    const ctx = canvas.getContext('2d');
    const matrices = [[[1.0, 0.0, 0.0, 0.0, 0.0], [0.44695591926574707, 0.5530441403388977, 0.0, 0.0, 0.0], [0.2836880385875702, 0.0352131687104702, 0.6810988783836365, 0.0, 0.0], [0.10488823801279068, 0.14376500248908997, 0.12526066601276398, 0.6260860562324524, 0.0], [0.5063276290893555, 0.16711631417274475, 0.10359900444746017, 0.029829425737261772, 0.1931276172399521]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.6899737119674683, 0.3100263476371765, 0.0, 0.0, 0.0], [0.1393570601940155, 0.6908707618713379, 0.1697721928358078, 0.0, 0.0], [0.1240176260471344, 0.2183721661567688, 0.6190515756607056, 0.03855863958597183, 0.0], [0.1467709094285965, 0.29657867550849915, 0.4679507911205292, 0.05476226657629013, 0.03393736109137535]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.7300586104393005, 0.26994138956069946, 0.0, 0.0, 0.0], [0.06558606028556824, 0.7873724102973938, 0.14704152941703796, 0.0, 0.0], [0.07059520483016968, 0.1183566227555275, 0.5224616527557373, 0.28858649730682373, 0.0], [0.2022586613893509, 0.030968228355050087, 0.19290097057819366, 0.5061372518539429, 0.06773488223552704]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.32422828674316406, 0.6757717132568359, 0.0, 0.0, 0.0], [0.06084080785512924, 0.0012696501798927784, 0.937889575958252, 0.0, 0.0], [0.2551549971103668, 0.02408551797270775, 0.028750086203217506, 0.6920093894004822, 0.0], [0.1177927553653717, 0.0015358806122094393, 0.018733017146587372, 0.034628141671419144, 0.8273102045059204]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9835493564605713, 0.016450613737106323, 0.0, 0.0, 0.0], [0.8959258198738098, 0.05765954405069351, 0.046414636075496674, 0.0, 0.0], [0.9041003584861755, 0.01798134669661522, 0.035075150430202484, 0.042843107134103775, 0.0], [0.6839302778244019, 0.026079146191477776, 0.039469216018915176, 0.23366758227348328, 0.01685377024114132]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9727022051811218, 0.02729780226945877, 0.0, 0.0, 0.0], [0.09476204961538315, 0.8826685547828674, 0.022569380700588226, 0.0, 0.0], [0.1215263232588768, 0.18349331617355347, 0.6292821764945984, 0.06569820642471313, 0.0], [0.14894546568393707, 0.1058426946401596, 0.37480077147483826, 0.3529062867164612, 0.01750473864376545]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9738619923591614, 0.02613797038793564, 0.0, 0.0, 0.0], [0.7845379114151001, 0.14008107781410217, 0.07538101822137833, 0.0, 0.0], [0.43287211656570435, 0.019466133788228035, 0.09457369148731232, 0.45308804512023926, 0.0], [0.5185744762420654, 0.03758504241704941, 0.03337795287370682, 0.4010540544986725, 0.00940846186131239]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.5680763125419617, 0.43192365765571594, 0.0, 0.0, 0.0], [0.7482025623321533, 0.2148088961839676, 0.03698854148387909, 0.0, 0.0], [0.3493465185165405, 0.4672371745109558, 0.11753971874713898, 0.06587658822536469, 0.0], [0.9015182852745056, 0.021983766928315163, 0.017705168575048447, 0.04606126621365547, 0.012731488794088364]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8778313398361206, 0.12216870486736298, 0.0, 0.0, 0.0], [0.8384688496589661, 0.09741572290658951, 0.06411545723676682, 0.0, 0.0], [0.7454469203948975, 0.0671529471874237, 0.16112832725048065, 0.026271775364875793, 0.0], [0.3876529335975647, 0.21844051778316498, 0.0984041690826416, 0.14619874954223633, 0.1493036448955536]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9043813943862915, 0.0956186056137085, 0.0, 0.0, 0.0], [0.1426018923521042, 0.8465527296066284, 0.010845406912267208, 0.0, 0.0], [0.07192879170179367, 0.8013125658035278, 0.09170336276292801, 0.03505527600646019, 0.0], [0.4644625186920166, 0.1988915055990219, 0.08023335784673691, 0.2024133950471878, 0.05399926379323006]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.6632508039474487, 0.33674922585487366, 0.0, 0.0, 0.0], [0.6879616379737854, 0.21048834919929504, 0.10155004262924194, 0.0, 0.0], [0.5756641626358032, 0.17184357345104218, 0.12784121930599213, 0.12465100735425949, 0.0], [0.537706196308136, 0.056139957159757614, 0.05378400906920433, 0.12223918735980988, 0.23013067245483398]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8450056314468384, 0.154994398355484, 0.0, 0.0, 0.0], [0.30242881178855896, 0.6266499161720276, 0.07092129439115524, 0.0, 0.0], [0.4615408182144165, 0.04128798842430115, 0.021863816305994987, 0.4753073751926422, 0.0], [0.35827192664146423, 0.020337658002972603, 0.011198707856237888, 0.5623098015785217, 0.04788188636302948]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.927193284034729, 0.07280674576759338, 0.0, 0.0, 0.0], [0.8505791425704956, 0.09265308082103729, 0.0567677803337574, 0.0, 0.0], [0.539391279220581, 0.10652615129947662, 0.0990603044629097, 0.255022257566452, 0.0], [0.4486922025680542, 0.09314147382974625, 0.08723507821559906, 0.2771937847137451, 0.09373749047517776]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9435719847679138, 0.056428056210279465, 0.0, 0.0, 0.0], [0.8616020083427429, 0.10760042816400528, 0.030797502025961876, 0.0, 0.0], [0.7066750526428223, 0.10739637911319733, 0.1097075566649437, 0.07622098177671432, 0.0], [0.7573819160461426, 0.09753742814064026, 0.05829767882823944, 0.07955840975046158, 0.007224558852612972]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.14460887014865875, 0.8553911447525024, 0.0, 0.0, 0.0], [0.24942056834697723, 0.7259637117385864, 0.02461577206850052, 0.0, 0.0], [0.13038800656795502, 0.7451417446136475, 0.04604661837220192, 0.07842361927032471, 0.0], [0.091917484998703, 0.7664254307746887, 0.03522390127182007, 0.09916574507951736, 0.007267501205205917]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.9056504368782043, 0.09434955567121506, 0.0, 0.0, 0.0], [0.8933621644973755, 0.03474802523851395, 0.07188984751701355, 0.0, 0.0], [0.866684079170227, 0.02211097627878189, 0.004485380370169878, 0.10671956092119217, 0.0], [0.9286484122276306, 0.0028289330657571554, 0.01315923873335123, 0.013435493223369122, 0.04192780330777168]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.5987796187400818, 0.401220440864563, 0.0, 0.0, 0.0], [0.16966643929481506, 0.5871860980987549, 0.24314740300178528, 0.0, 0.0], [0.10576978325843811, 0.2013154923915863, 0.4815627932548523, 0.21135187149047852, 0.0], [0.1694808453321457, 0.20841339230537415, 0.20055502653121948, 0.29215526580810547, 0.1293955296278]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.6666815876960754, 0.33331844210624695, 0.0, 0.0, 0.0], [0.835027277469635, 0.00017830505385063589, 0.16479447484016418, 0.0, 0.0], [0.7706727385520935, 0.0007192677003331482, 0.016882801428437233, 0.21172520518302917, 0.0], [0.8347762227058411, 0.00032770357211120427, 0.007966543547809124, 0.0033200790639966726, 0.1536095291376114]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.4128798246383667, 0.5871202349662781, 0.0, 0.0, 0.0], [0.06514065712690353, 0.8955059051513672, 0.03935346007347107, 0.0, 0.0], [0.33835095167160034, 0.09906846284866333, 0.06750323623418808, 0.49507734179496765, 0.0], [0.22615869343280792, 0.48285967111587524, 0.02322123572230339, 0.26448822021484375, 0.0032721091993153095]], [[1.0, 0.0, 0.0, 0.0, 0.0], [0.8914564847946167, 0.1085435003042221, 0.0, 0.0, 0.0], [0.35692402720451355, 0.2278652936220169, 0.41521066427230835, 0.0, 0.0], [0.5679773092269897, 0.13438013195991516, 0.20152647793293, 0.09611614048480988, 0.0], [0.39672040939331055, 0.14568264782428741, 0.10294228792190552, 0.2557571530342102, 0.0988975241780281]]];
    const rows = 5;
    const cols = 5;
    const minVals = [0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0];
    const maxVals = [1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0, 1.0];
    const hues = [319, 215, 177, 18, 102, 265, 18, 348, 275, 349, 329, 118, 307, 122, 47, 295, 325, 359, 69, 260];
    let fixedMatrixIndex = null;
    let currentMatrixIndex = 0;
    let currentMode = 'row'; // Default mode
    const legendCanvas = document.getElementById('legendCanvas');
    const legendCtx = legendCanvas.getContext('2d');

    function resizeCanvas() {
        const canvasWrapper = document.querySelector('.canvas-wrapper');
        canvas.width = canvasWrapper.clientWidth;
        canvas.height = canvasWrapper.clientHeight;
        drawMatrix(currentMatrixIndex);
    }

    window.addEventListener('resize', resizeCanvas);
    resizeCanvas();

    function valueToColor(value, minVal, maxVal, hue, dim = false) {
        const normalizedValue = (value - minVal) / (maxVal - minVal);
        const lightness = 100 - Math.floor(normalizedValue * 75);  // lightness from 25% to 100%
        if (dim) {
            return `hsl(${hue}, 0%, ${lightness}%)`;  // Dim the brightness for non-highlighted rows
        }
        return `hsl(${hue}, 100%, ${lightness}%)`;
    }

    function drawMatrix(matrixIndex, highlightIndex = null) {
        const data = matrices[matrixIndex];
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        const currentRows = data.length;
        const currentCols = data[0].length;
        const cellWidth = Math.floor(canvas.width / currentCols);
        const cellHeight = Math.floor(canvas.height / currentRows);

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        for (let i = 0; i < currentRows; i++) {
            for (let j = 0; j < currentCols; j++) {
                let dim = false;
                if (highlightIndex !== null) {
                    if (currentMode === 'row' && i !== highlightIndex) {
                        dim = true;
                    } else if (currentMode === 'column' && j !== highlightIndex) {
                        dim = true;
                    }
                }
                ctx.fillStyle = valueToColor(data[i][j], minVal, maxVal, hue, dim);
                ctx.fillRect(j * cellWidth, i * cellHeight, cellWidth, cellHeight);
            }
        }
    }

    function showMatrix(matrixIndex, updateTokens = false) {
        currentMatrixIndex = matrixIndex;
        if (fixedMatrixIndex === null) {
            drawMatrix(matrixIndex);
        }
        if (updateTokens) {
            const rowOrColumn = matrices[matrixIndex][0];
            const minVal = minVals[matrixIndex];
            const maxVal = maxVals[matrixIndex];
            const hue = hues[matrixIndex];
            for (let i = 0; i < rowOrColumn.length; i++) {
                const tokenElem = document.getElementById('token' + i);
                tokenElem.style.backgroundColor = valueToColor(rowOrColumn[i], minVal, maxVal, hue);
            }
        }
        updateLegend();
    }
    
    function drawLegend(minVal, maxVal, hue) {
        const gradient = legendCtx.createLinearGradient(0, 0, legendCanvas.width, 0);
        for (let i = 0; i <= 100; i++) {
            const value = minVal + (i / 100) * (maxVal - minVal);
            const color = valueToColor(value, minVal, maxVal, hue);
            gradient.addColorStop(i / 100, color);
        }

        legendCtx.fillStyle = gradient;
        legendCtx.fillRect(0, 0, legendCanvas.width, legendCanvas.height);

        // Add text labels for min and max values
        legendCtx.fillStyle = 'black';
        legendCtx.font = '14px Arial';
        legendCtx.fontWeight = 'bold';
        legendCtx.fillText(minVal.toFixed(2), 0, legendCanvas.height - 3);
        legendCtx.fillText(maxVal.toFixed(2), legendCanvas.width - 30, legendCanvas.height - 3);
    }

    function updateLegend() {
        const minVal = minVals[currentMatrixIndex];
        const maxVal = maxVals[currentMatrixIndex];
        const hue = hues[currentMatrixIndex];
        drawLegend(minVal, maxVal, hue);
    }

    function toggleFixMatrix(matrixIndex) {
        if (fixedMatrixIndex === matrixIndex) {
            fixedMatrixIndex = null;
            document.getElementById('button' + matrixIndex).classList.remove('neon');
        } else {
            fixedMatrixIndex = matrixIndex;
            // Remove neon effect from all buttons
            for (let i = 0; i < matrices.length; i++) {
                document.getElementById('button' + i).classList.remove('neon');
            }
            // Add neon effect to the selected button
            document.getElementById('button' + matrixIndex).classList.add('neon');
        }
        drawMatrix(matrixIndex);
    }

    function highlightRowOrColumnAndToken(index) {
        if (currentMode === 'row') {
            highlightRow(index);
        } else {
            highlightColumn(index);
        }
        highlightToken(index);
    }

    function highlightRow(rowIndex) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        drawMatrix(matrixIndex, rowIndex);
    }

    function highlightColumn(colIndex) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        drawMatrix(matrixIndex, colIndex);
    }

    function highlightToken(index) {
        const matrixIndex = fixedMatrixIndex !== null ? fixedMatrixIndex : currentMatrixIndex;
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        let values;
        if (currentMode === 'row') {
            values = matrices[matrixIndex][index];
        } else {
            values = matrices[matrixIndex].map(row => row[index]);
        }
        for (let i = 0; i < values.length; i++) {
            const tokenElem = document.getElementById('token' + i);
            tokenElem.style.backgroundColor = valueToColor(values[i], minVal, maxVal, hue);
        }
    }

    function toggleFixRowOrColumn(index) {
        if (fixedMatrixIndex !== null) {
            if (currentMode === 'row') {
                highlightRow(index);
            } else {
                highlightColumn(index);
            }
        }
    }

    function drawPreview(matrixIndex) {
        const previewCanvas = document.getElementById('previewCanvas' + matrixIndex);
        const previewCtx = previewCanvas.getContext('2d');
        const data = matrices[matrixIndex];
        const minVal = minVals[matrixIndex];
        const maxVal = maxVals[matrixIndex];
        const hue = hues[matrixIndex];
        const previewRows = previewCanvas.height;
        const previewCols = previewCanvas.width;
        const cellHeight = Math.max(previewCanvas.height / data.length, 2);
        const cellWidth = Math.max(previewCanvas.width / data[0].length, 2);
        const maxIndex = Math.min(previewRows / cellWidth, data.length);
        console.log(cellWidth, cellHeight, maxIndex)
        for (let i = 0; i < maxIndex; i++) {
            for (let j = 0; j < maxIndex; j++) {
                previewCtx.fillStyle = valueToColor(data[i][j], minVal, maxVal, hue);
                previewCtx.fillRect(j * cellWidth, i * cellHeight, cellWidth, cellHeight);
            }
        }
    }

    function setMode(mode) {
        currentMode = mode;
        document.getElementById('rowMode').classList.toggle('active', mode === 'row');
        document.getElementById('columnMode').classList.toggle('active', mode === 'column');
        // Redraw the matrix to update the neon effect
        drawMatrix(currentMatrixIndex);
        updateLegend();
    }

    // Draw previews
    for (let i = 0; i < matrices.length; i++) {
        drawPreview(i);
    }

    // Initial display
    showMatrix(currentMatrixIndex);
</script>
</body>
</html>
    